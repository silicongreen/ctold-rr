<% if @current_user.admin? %>
<style>
  .header-wrapper .tabbed-header-wrapper ul.header-tabs li a {
      color: #c2c5c6;
      font-size: 14px;
      letter-spacing: 0.75px;
      text-decoration: none;
      display: block;
      padding: 17px 12px !important;
  }
</style>
<% end %>
<div class="header-wrapper">
    <div class="header-title">
        <div class="header-icon">
            <%= image_tag '/images/icons/profile-icon.png', :html => {:alt => 'Student Profile'} %>
        </div>
        <div class="header-title-text-wrapper">
            <div class="header-title-main-text f2" style="text-transform: capitalize; padding-top: 27px;">
                Student Batch Log
            </div>
            <div class="clearfix"></div>
        </div>
    </div>

    <% if @current_user.admin? or permitted_to? :edit, :student%>
      <div class="header-form-wrapper">
          <div class="icon-wrapper">
              <%= link_to '<div class="edit-icon"></div>', :controller => 'student', :action => 'edit', :id => @student.id %>
          </div>
      </div>
    <% end %>

    <div class="clearfix"></div>

    <div class="tabbed-header-wrapper">
        <ul class="header-tabs">
            <% if permitted_to? :profile,:student %>
              <li >
                  <%= link_to "#{t('student_profile')}", {:controller => 'student', :action => 'profile', :id => @student.id}, {:class => 'f2'} %>
              </li>
            <%end%>

            <% if permitted_to? :reports,:student and !check_free_school? %>
              <li>
                  <%= link_to "#{t('reports_text')}", {:controller => 'student', :action => 'reports', :id => @student}, {:class => 'f2'} %>
              </li>
            <%  end %>

            <% BatchStudent.find_by_student_id(@student.id) %>  

            <% if !BatchStudent.blank? %>
              <li>
                  <%= link_to "Previous Report", {:controller => "student", :action => "previous_report", :id => @student.id}, {:class => 'f2'} %>
              </li>
            <%  end %> 

            <% if permitted_to? :guardians,:student %>
              <li>
                  <%= link_to "#{t('guardians_text')}", {:controller => "student", :action => "guardians", :id => @student.id}, {:class => 'f2'} %>
              </li>
            <% end %>

            <% if !check_free_school? %>
              <% Champs21Plugin::ADDITIONAL_LINKS[:student_profile_more_menu].each do |mod| %>
                <% if can_access_request? "#{mod[:destination][:action]}".to_sym,"#{mod[:destination][:controller]}".to_sym %>
                  <% unless t(mod[:title]) == "Hostel" %>
                    <li>
                        <%= link_to "#{t(mod[:title])}", mod[:destination].merge(:id=>@student.id), {:class => 'f2'} %>
                    </li>
                  <% end %>
                <% end %>
              <% end %>
            <% end %> 

            <% if school_form_apply? and ( @current_user.admin? or permitted_to? :form_to_apply, :student ) %>
              <li>
                  <%= link_to "#{t('form_text')}", {:controller => "student", :action => "form_to_apply", :id => @student.id}, {:class => 'f2'} %>
              </li>
            <% end %>   
              
              
            <% if permitted_to? :student_security, :student %>
              <li><%= link_to "Security Card", {:controller => 'student', :action => 'student_security', :id => @student.id}, {:class => 'f2'} %></li>
            <% end %>

            <% if @current_user.admin? %>
              <li><%= link_to "Category Log", {:controller => 'student', :action => 'category_log', :id => @student.id}, {:class => 'f2'} %></li>
              <li class="active"><%= link_to "Batch Log", {:controller => 'student', :action => 'batch_log', :id => @student.id}, {:class => 'f2'} %></li>
            <% end %>   

            <% if permitted_to? :remove, :student or permitted_to? :admission1, :student %>
              <li>
                  <%= link_to "#{t('delete_text')}", {:controller => 'student', :action => 'remove', :id => @student.id}, {:class => 'f2'} %>
              </li>
            <% end %>
        </ul>
    </div>
</div>
<% default_image = "/images/HR/default_employee.png" %>
<div id="page-yield" class="bg-disable">
    <div id="personal_detail">
      <div id="student_profile_heading">
          <div id="profile_picture_display">
              <% if @student.photo.file? %>
                <% @profile_image = @student.photo.url %>
                <% unless @profile_image.index("RackMultipart").nil? %>	
                    <% if @student.photo.exists? %>
                      <% @profile_image.gsub! '?', '.?' %>
                    <% else %>
                      <% @profile_image = "master_student/profile/default_student.png" %>
                    <% end %>	
                <% end %>

              <% else %>
                <% @profile_image = "master_student/profile/default_student.png" %>
              <% end %>

              <%= image_tag "#{@profile_image}", :width=>"125" %>
              <% if @student.photo.file? %>
              <% if @current_user.admin? or permitted_to? :remove_photo, :student %>
              <div class="image-delete-link" />
                 <%= link_to '<img src="/images/buttons/delete-new.png" />', {:controller => 'student', :action => 'remove_photo', :id => @student.id}, :confirm => "Do you realy want to remove this photo?" %>
              </div>
              <% end %>

              <% end %>
              <% if permitted_to? :edit_student_guardian, :student %>
                <% @config = Configuration.find_by_config_key('ParentCanEdit') %>
                  <% if !@config.blank? and !@config.config_value.blank? and @config.config_value.to_i == 1 %>
                    <div class="image-delete-link" style="margin-top:-31px;" />
                        <%= link_to '<div class="edit-icon">Edit</div>',
                          {:controller => "student", :action => "edit_student_guardian", :id => @student.id}, :class=> 'user_button small-button' %>
                    </div>
                <% end %>

              <% end %>

          </div>

          <div id ="student_main_info">
              <div id="student_name" class="f2"><%= @student.full_name %></div>
              <div id="student_class"><%= @student.batch.course.course_name %></div>
          </div>
          
          <div id="personal_info_wrapper">
            <div id="class_info">
                <% if Batch.active.find(:all, :group => "name").length > 1  %>
                  <div class="infos">
                      <div><%= @student.batch.name %></div>
                      <div><%= t('batch_text') %></div>
                  </div>
                <% end %>
                <div class="infos">
                    <div><%= @student.admission_no %></div>
                    <div><%= t('adm_no') %></div>
                </div>
                <div class="infos last">
                    <% unless  @student.batch.course.section_name.empty? %>
                    <div><%= @student.batch.course.section_name %></div>
                    <div><%= t('profile_section_label') %></div>
                    <% else %>
                    <div> No Section</div>
                    <div></div>
                    <% end %>
                    
                </div>
            </div>
          </div>
      </div>
    </div>
    <div style="clear: both; height: 100px;"></div>
    <div class="student-security-form">
        <h2>Student Batch Log</h2>
        <table class="table table-striped table-bordered" id="example" cellspacing="0" cellpadding="0" border="0" style="width: 98%;">
            <thead><!-- class="thead-inverse" -->
              <tr>
                <th style="font-weight: normal; width: 8%; text-align: center; font-family: verdana; font-size: 12px;"><%= t('sl_no') %> </th>
                <th style="font-weight: normal; width: 10%; text-align: center; font-family: verdana; font-size: 12px;"><%= "Change Date" %></th>
                <th style="font-weight: normal; width: 15%; text-align: center; font-family: verdana; font-size: 12px;"><%= "Batch Name" %></th>
                <th style="font-weight: normal; width: 14%; text-align: center; font-family: verdana; font-size: 12px;"><%= "Remote IP" %></th>
                <th style="font-weight: normal; width: 24%; text-align: center; font-family: verdana; font-size: 12px;"><%= "Browser" %></th>
                <th style="font-weight: normal; width: 14%; text-align: center; font-family: verdana; font-size: 12px;"><%= "User" %></th>
              </tr>
            </thead>
            <tbody>
                <% unless @student_batch_logs.blank? %>
                  <% @student_batch_logs.each_with_index do |student_batch_log, i| %>
                  <tr>
                      <td style="font-weight: normal; text-align: center; font-family: verdana; font-size: 12px;"><%= i + 1 %> </td>
                      <td style="font-weight: normal; text-align: center; font-family: verdana; font-size: 12px;"><%= student_batch_log.created_at.strftime("%Y-%m-%d") %></td>
                      <td style="font-weight: normal; text-align: center; font-family: verdana; font-size: 12px;"><%= student_batch_log.batch.full_name %></td>
                      <td style="font-weight: normal; text-align: center; font-family: verdana; font-size: 12px;"><%= student_batch_log.ip %></td>
                      <td style="font-weight: normal; text-align: center; font-family: verdana; font-size: 12px;"><%= student_batch_log.user_agent %></td>
                      <td style="font-weight: normal; text-align: center; font-family: verdana; font-size: 12px;"><%= student_batch_log.user.username %></td>
                  </tr>
                  <% end %>
                <% else %>  
                  <tr>
                      <td colspan="6">No Record Found</td>
                  </tr>
                <% end %>
            </tbody>
        </table>
    </div>
</div>
<div class="clearfix"></div>


<%= stylesheet_link_tag 'tadded-header' %>
<% content_for :head do %>
  <%= javascript_include_tag "custom/tabbed-header" %>
<% end %>


<style type="text/css">

    #student_profile_heading {
        background: url("/images/backgrounds/top_profile.png") no-repeat scroll 0 0 rgba(0, 0, 0, 0);
    }
    #student_name, #student_class {
        color: #fff;
    }
    #student_main_info {
        padding: 17px 0 0 30px;
    }
    #student_name {
        text-transform: uppercase;
    }
    .header-wrapper {
        padding: 0;
    }
    .header-wrapper .header-form-wrapper {
        width: 8%;
    }
    .header-wrapper .header-form-wrapper .icon-wrapper {
        border-left: 1px solid #dfe1e2;
    }
    .header-wrapper  .header-form-wrapper .icon-wrapper a {
        display: block;
        padding: 25px 0 28px 21px;
    }
    .header-wrapper  .header-form-wrapper .icon-wrapper a .edit-icon {
        background: url("/images/icons/edit.png") no-repeat scroll 0 0 / 35px 35px rgba(0, 0, 0, 0);
        height: 35px;
        width: 35px;
    }
    .header-wrapper  .header-form-wrapper .icon-wrapper a:hover > .edit-icon {
        background: url("/images/icons/edit_hover.png") no-repeat scroll 0 0 / 35px 35px rgba(0, 0, 0, 0);
    }
    .image-delete-link
    {
        float: right;
        clear: both;
        margin-top: -13px;
        margin-right: 3px;
        color: red;
    }
    #profile_picture_display img
    {
      float:left;
      clear:both;
    }
</style>
<style type="text/css">
    .student-security-form{background-color: #fff; width:96%; padding:20px; text-align: center;}

</style>

