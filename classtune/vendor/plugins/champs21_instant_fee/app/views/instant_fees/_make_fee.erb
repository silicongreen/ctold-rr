<%-# Champs21
#Copyright 2010 teamCreative Private Limited
#
#This product includes software developed at
#Project Champs21 - http://www.champs21.com/
#
#Licensed under the Apache License, Version 2.0 (the "License");
#you may not use this file except in compliance with the License.
#You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
#Unless required by applicable law or agreed to in writing,
#software distributed under the License is distributed on an
#"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
#KIND, either express or implied.  See the License for the
#specific language governing permissions and limitations
#under the License. -%>
<% total_fees =0 %>
<% form_for :fees, :url => {:action => 'create_instant_fee'},:html => {:onsubmit => "return validate_make_fee()"} do |form| %>
  <%= hidden_field_tag :category_id,@instant_category.id %>
  <% if @employee_id.present? %>
    <%= hidden_field_tag :employee_id,@employee_id %>
  <% else %>
    <%= hidden_field_tag :student_id,@student_id %>
  <% end %>
  <table class="table table-striped table-bordered" id="instant_fee" cellspacing="0" cellpadding="0" border="0" style="width: 98%;">
    <thead><!-- class="thead-inverse" -->
      <tr>
        <th><%= t('sl_no') %> </th>
        <th><%= t('particular') %></th>
        <th><%= t('amount') %> </th>
        <th><%= t('quantity') %> </th>
        <th><%= "#{t('discount')} (%)" %> </th>
        <th colspan ="2"><%= t('total_amount') %> </th>
      </tr>
    </thead>
    <tbody>
    <% i = 1 %>
    <% unless @instant_fee_particulars.nil? %>
      <% @instant_fee_particulars.each do |fee| %>
        <tr id="tr_fee_<%= i %>" class="tr-odd particulars_tr">
          <td class="col-1">
              <span id="sn_span_<%= i %>" style="font-weight: bold; padding-top: 10px; display: block; text-align: center;"><%= i %></span>
          </td>
          <td class="col-2 feename" style="vertical-align: middle; width: 25%;"><%= shorten_string(fee.name,50) %></td>
          <td class="col-3 label-field-pair feeamount" style="width: 20%;">
              <div class="input-container">
                <%= text_field_tag 'amount[]',precision_label(fee.amount),:id => "amount_#{i}",:onchange=> "update_total_by_amount(this)" ,:class=>'amount precision_text' %>
              </div>
          </td>
          <td class="col-3 label-field-pair feequantity" style="width: 5%;">
              <% if fee.quantity == 0 %>
              <span id="total_quantity_span_<%= i %>" style="font-weight: bold; padding-top: 10px; display: block; text-align: center;">&minus;</span>
              <%= hidden_field_tag 'quantity[]', 1, {:id => "quantity_#{i}"}  %>
              <% else %>
              <div class="input-container" style="width: 40%;">
                <%= text_field_tag 'quantity[]',1,:id => "quantity_#{i}",:onchange=> "update_total_by_quantity(this)" ,:class=>'' %>
              </div>
              <% end %>
          </td>
          <td class="col-3 label-field-pair feediscount" style="width: 15%;">
              <div class="input-container">
                <%= text_field_tag 'discount[]',0,:id => "discount_#{i}",:onchange=> "update_total_by_discount(this)", :class=>'precision_text' %>
              </div>
          </td>
          <td class="col-3 label-field-pair feetotal" style="width: 20%;">
              <span id="total_check_span_<%= i %>" style="font-weight: bold; padding-top: 10px; display: block; text-align: right;"><%= precision_label(fee.amount) %></span>
              <div class="input-container hide2">
                <%= text_field_tag 'total[]',precision_label(fee.amount),:id => "total_check_#{i}",:class=>'particular_total',:readonly=> true %>
              </div>
          </td>
          <td class="col-select feecross" style="padding-top: 18px;">
              <%= check_box_tag 'particular_ids[]',fee.id,true,:class => 'par_check css-checkbox',:id => "check_#{i}",:onclick=> "assign_amt(this)" %>
              <label for="check_<%=  i %>" class="css-label lite-plus"></label>  
          </td>
        </tr>
        <% total_fees += fee.amount %>
        <% i += 1 %>
      <% end %>
    <% else %>
    <tr id="tr_fee_<%= i %>" class="tr-odd particulars_tr particulars_tr_custom">
      <td class="col-1">
          <span id="sn_span_<%= i %>" style="font-weight: bold; padding-top: 10px; display: block; text-align: center;"><%= i %></span>
      </td>
      <td class="col-2 label-field-pair feename" style="vertical-align: middle; width: 25%;">
          <div class="input-container" style="width: 77%;">
          <%= text_field_tag 'name[]',"",:id => "name_#{i}" ,:class=>'particular_name' %>
          </div>
      </td>
      <td class="col-3 label-field-pair feeamount" style="width: 20%;">
          <div class="input-container">
            <%= text_field_tag 'amount[]',precision_label(0.0),:id => "amount_#{i}",:onchange=> "update_total_by_amount(this)" ,:class=>'amount precision_text' %>
          </div>
      </td>
      <td class="col-3 label-field-pair feequantity" style="width: 5%;">
          <div class="input-container" style="width: 40%;">
            <%= text_field_tag 'quantity[]',1,:id => "quantity_#{i}",:onchange=> "update_total_by_quantity(this)" ,:class=>'' %>
          </div>
      </td>
      <td class="col-3 label-field-pair feediscount" style="width: 15%;">
          <div class="input-container">
            <%= text_field_tag 'discount[]',0,:id => "discount_#{i}",:onchange=> "update_total_by_discount(this)", :class=>'precision_text' %>
          </div>
      </td>
      <td class="col-3 label-field-pair feetotal" style="width: 20%;">
          <span id="total_check_span_<%= i %>" style="font-weight: bold; padding-top: 10px; display: block; text-align: right;"><%= precision_label(0.0) %></span>
          <div class="input-container hide2">
            <%= text_field_tag 'total[]',precision_label(0.0),:id => "total_check_#{i}",:class=>'particular_total',:readonly=> true %>
          </div>
      </td>
      <td class="col-select feecross" style="padding-top: 18px;">
          
      </td>
    </tr>    
    <%end%>
    <tr class="tr-even" cellpadding="1" cellspacing="1">
      <td class="col-1"></td>
      <td class="col-pay" colspan="4"><%= t('amount_to_pay') %>:</td>
      <td id="total" class="col-2" style="text-align: right;">
          <span id="total_span" style="font-weight: bold; display: block; text-align: right;"><%= precision_label(total_fees) %></span>
      </td>
      <td class="col-1" style="border: 0 !important;"></td>
    </tr>
    <tr>
      <td colspan="7">
        <div class="pay_fees">
          <div class="options-pay"><a id="addrow" href="javascript:;" onclick="insRow()" >+ <%= t('add_particular') %></a></div>
        </div>
      </td>
    </tr>
    <tr>
      <td colspan="7">
        <div class="payment_details">
          <div style="width: 59%; float: left; border-right: 1px solid #ccc;">
              <div class="label-field-pair" style="width: 99%;">
                <div class="label-container"><%= t('payment_mode') %>  <%= image_tag("loader.gif",
                  :align => "absmiddle",
                  :border => 0,
                  :id => "loader1",
                  :style =>"display: none;" ) %></div>
                <div class="input-container">
                    <%= select :fees, :payment_mode, [["#{t('cash')}", "#{t('cash')}"],["#{t('online_payment')}", "#{t('online_payment')}"],["#{t('cheque')}", "#{t('cheque')}"],["#{t('dd')}","#{t('dd')}"],["#{t('others')}", "#{t('others')}"]], {} ,{:onChange => "#{remote_function(:url => {:action => "select_payment_mode"},
                        :with => "'payment_mode='+value",:before => "$('loader1').show();",
                        :success => "$('loader1').hide();")}"}  %>
                    <span id="payment_mode" style="display: block;"></span>
                </div>
            </div>
            <div class="label-field-pair" style="width: 99%;">
              <div class="label-container"><%= t('payment_notes') %> </div>
              <div class="input-container"><%= form.text_area :payment_note,:cols => 50, :rows => 1 %></div>
            </div>
          </div>  
          <div class="pay_fees" style="width: 228px;">
              <%= hidden_field_tag :total_fees, total_fees %>
              <div class="options-pay">
                <%= form.submit "â–º #{t('pay_fees')}",:class=>'submit_button' , :id=>'pay_button', :disable_with => "â–º #{t('please_wait')}"%>
              </div>
          </div>
        </div>
      </td>
    </tr>
    </tbody>
  </table>
<%end%>


