<%-# Champs21
#Copyright 2010 teamCreative Private Limited
#
#This product includes software developed at
#Project Champs21 - http://www.champs21.com/
#
#Licensed under the Apache License, Version 2.0 (the "License");
#you may not use this file except in compliance with the License.
#You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
#Unless required by applicable law or agreed to in writing,
#software distributed under the License is distributed on an
#"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
#KIND, either express or implied.  See the License for the
#specific language governing permissions and limitations
#under the License. -%>

<span style="padding: 8px 15px 2px 13px; font-weight: bold; display: block; font-size: 14px; font-family: verdana; text-align: left;">Fee Defaulters List:</span>  
<% if @defaulters.empty? %>
  <p class="flash-msg"><%= t('no_defaulters') %></p>
<% else %>
  <table class="table table-striped table-bordered" id="example" cellspacing="0" cellpadding="0" border="0" style="width: 100%; margin-top: 10px;">
    <thead><!-- class="thead-inverse" -->
      <tr>
        <th><%= t('sl_no') %></th>
        <th><%= t('admission_no') %></th>
        <th><%= t('students_name') %></th>
        <th><%= "Amount" %></th>
        <th></th>
      </tr>
    </thead>
    <tbody>
    <%@defaulters.each_with_index do |s,i| %>
    <% unless @date == 0 %>
      <% if @multi_date %>
      <% dates = @dates.map(&:id) %>
      <% fee = s.finance_fees.select{ |f| dates.include?(f.fee_collection_id.to_i)} %>
      <% @date = FinanceFeeCollection.find(fee[0].fee_collection_id) %>  
      <% else %>
      <% fee = s.finance_fees.select{ |f| f.fee_collection_id.to_i == @date.id.to_i} %>
      <% end %>
      <% #fee = s.finance_fees.select{ |f| f.fee_collection_id.to_i == @date.id.to_i} %>
      <%if s.check_fee_pay(@date) == false %>
        <tr class="<%= cycle('odd', 'even')%>">
          <td class="col-5"><%= i+1 %></td>
          <td class="col-1"><%= s.admission_no %></td>
          <td class="col-7" style="text-align: left;">
            <%= s.full_name %>
            <% if @multi_date %>  
              <br /><small>Batch: <%= s.batch.full_name %></small>
            <% end %>  
          </td>
          <%#= fee[0].balance %>
          <td class="col-7"><%= to_comma_seperated_precision_label fee.map(&:balance).sum %></td>
          <td class="col-1"><%= link_to "► #{t('pay_fees')}", "/student/fee_details/#{s.id}/#{@date.id}" ,:class=>'submit_button'  %></td>
        </tr>
      <%end%>
      <%else%>
        <% fee = s.finance_fees %>
        <%  %>
          <tr class="<%= cycle('odd', 'even')%>">
            <td class="col-5"><%= i+1 %></td>
            <td class="col-1"><%= s.admission_no %></td>
            <td class="col-7" style="text-align: left;">
                <%= s.full_name %>
                <br /><small>Batch: <%= s.batch.full_name %></small>
            </td>
            <td class="col-7"><%= to_comma_seperated_precision_label fee.map(&:balance).sum %></td>
            <td class="col-1"><%= link_to "► #{t('pay_fees')}", {:action => "fees_student_dates",:id => s.id } ,:class=>'submit_button'  %></td>
          </tr>
      <%end%>
    <% end %>
    </tbody>
  </table>
  <div style='padding-bottom: 20px;'>
  <% unless @date == 0 %>
    <% if @opt.to_i == 0 %>  
      <%= link_to " ► #{t('pdf_report')}",
                {:controller => "finance", :action => "fee_defaulters_pdf", :batch_id => @batch.id, :date => @date.id},:target => '_blank', :class=> 'user_button' %>
      <%= link_to " ► #{t('download_as_excel')}",
                {:controller => "finance", :action => "fee_defaulters_excel", :batch_id => @batch.id, :date => @date.id},:target => '_blank', :class=> 'user_button' %>
    <% else %>  
      <% if @opt.to_i == 2 %>  
        <%= link_to " ► #{t('pdf_report')}",
                {:controller => "finance", :action => "fee_defaulters_pdf", :opt => 2, :batch_id => @b_id, :course_name => @course_name, :section_id => @section_id, :date => @d_id},:target => '_blank', :class=> 'user_button' %>
        <%= link_to " ► #{t('download_as_excel')}",
                {:controller => "finance", :action => "fee_defaulters_excel", :opt => 2, :batch_id => @b_id, :course_name => @course_name, :section_id => @section_id, :date => @d_id},:target => '_blank', :class=> 'user_button' %>
      <% elsif @opt.to_i == 1 %>
        <%= link_to " ► #{t('pdf_report')}",
              {:controller => "finance", :action => "fee_defaulters_pdf", :opt => 1, :filter_by_course => @filter_by_course, :date => @d_id},:target => '_blank', :class=> 'user_button' %>
        <%= link_to " ► #{t('download_as_excel')}",
              {:controller => "finance", :action => "fee_defaulters_excel", :opt => 1, :filter_by_course => @filter_by_course, :date => @d_id},:target => '_blank', :class=> 'user_button' %>
      <% end %>  
    <% end %>  
    <% else %>
      <% if @opt.to_i == 0 %> 
      <%= link_to " ► #{t('pdf_report')}",
                {:controller => "finance", :action => "fee_defaulters_pdf", :batch_id => @batch.id, :date => @date},:target => '_blank', :class=> 'user_button' %>
      <%= link_to " ► #{t('download_as_excel')}",
                {:controller => "finance", :action => "fee_defaulters_excel", :batch_id => @batch.id, :date => @date},:target => '_blank', :class=> 'user_button' %>
      <% else %>
        <% if @opt.to_i == 2 %>  
          <%= link_to " ► #{t('pdf_report')}",
                  {:controller => "finance", :action => "fee_defaulters_pdf", :opt => 2, :batch_id => @b_id, :course_name => @course_name, :section_id => @section_id, :date => @d_id},:target => '_blank', :class=> 'user_button' %>
          <%= link_to " ► #{t('download_as_excel')}",
                  {:controller => "finance", :action => "fee_defaulters_excel", :opt => 2, :batch_id => @b_id, :course_name => @course_name, :section_id => @section_id, :date => @d_id},:target => '_blank', :class=> 'user_button' %>
        <% elsif @opt.to_i == 1 %>
          <%= link_to " ► #{t('pdf_report')}",
                {:controller => "finance", :action => "fee_defaulters_pdf", :opt => 1, :filter_by_course => @filter_by_course, :date => @d_id},:target => '_blank', :class=> 'user_button' %>
          <%= link_to " ► #{t('download_as_excel')}",
                {:controller => "finance", :action => "fee_defaulters_excel", :opt => 1, :filter_by_course => @filter_by_course, :date => @d_id},:target => '_blank', :class=> 'user_button' %>
        <% end %>  
      <% end %>
  <% end %>
 </div>     
<% end %>
<style>
    .user_button {margin: 0;}
</style>