<%= load_latex_preview %>
<div id="box">
  <% unless @exam_questions.nil? or @exam_questions.empty? %>
    <% form_for @exam_attendance, :url=>{:action=>'save_exam'} do |f| %>
      <%=hidden_field_tag('attendance_id',@exam_attendance.id )%>
      <% @exam_questions.each_with_index do |question,i| %>
        <% if params[:page].present? %>
          <% if params[:page].to_i >= 1 %>
            <% i = i  + (params[:page].to_i - 1) * @exam_questions.per_page.to_i %>
          <% end %> <%else %> <% i = i %>
        <% end %>
        <div class="label-field-pair1">
          <div class="q-label"><%="#{ i+1} )" %></div>
          <div class="question">
            <div class="question-content">
              <%=question.question %>
            </div>
            <div class="mark">
              (<%= t('mark') %>:<%=question.mark %>)
            </div>
          </div>
        </div>
        <div class="label-field-pair1">
          <div class="op-label"><%= t('options') %> :</div>
          <div class="extender"></div>
          <% f.fields_for :online_exam_score_details ,@options[question.id] do |exam_form| %>
            <% if exam_form.object.online_exam_question_id==question.id %>
              <div class="option_pair">
                <div class="option"><%=exam_form.object.online_exam_option.option%> </div>
                <%= exam_form.hidden_field :online_exam_option_id %>
                <%= exam_form.hidden_field :online_exam_question_id %>
                <% unless @selected_options.nil? %>
                  <%= exam_form.hidden_field :id,:value=>@selected_options[exam_form.object.online_exam_option_id].nil?? "" :@selected_options[exam_form.object.online_exam_option_id][0].id %>
                  <div class="text-input-bg">
                    <%= exam_form.check_box :_delete ,{:checked => @selected_options[exam_form.object.online_exam_option_id]!= nil},0,1 %>
                  </div>
                <% else %>
                  <%= exam_form.check_box :_delete ,{},0,1 %>
                <% end %>
              </div>
              <div class="extender"></div>
            <% end %>
          <% end %>

          
        </div>
        <div class="extender"></div>
        <hr width="850" size="3" color="#27292B" noshade class="horizontal-line"></hr>
      <% end %>
      
      <div id="submit-button">
        
        <%
        num_total_pages = (@num_exam_questions.to_f / @per_page.to_f)
        num_total_pages = num_total_pages.ceil
        cur_page = 1
        unless params[:page].nil?
          cur_page = params[:page]
        end
        if cur_page.to_i < num_total_pages
          btn_txt = 'quit'
        else
          btn_txt = 'finish'
        end
        %>
        <%#= page_no %>
        <%= f.submit " â–º #{t(btn_txt)}" ,:confirm => "#{t('finsih_exam_confirm')}"%>
      </div>
    <% end %>
  <% end %>
  <%= will_paginate @exam_questions,:renderer => 'RemoteLinkRenderer' ,:params=>{:controller=>"online_student_exam",:action=>"started_exam",:id=>params[:id],:attendance_id=>@exam_attendance.id}%>
</div>
<%= stylesheet_link_tag 'pagination_and_table' %>
<script type="text/javascript">
  var j = jQuery.noConflict();
  j('.pagination a').click(function(e){
    j.post('/online_student_exam/save_scores',j('form').serialize())
  });
  j('html, body').animate({ scrollTop: 0 }, "slow");
</script>
<style type="text/css">
  .pagination {
    margin-top: -100px;
  }
  .q-label {
    color: #333333;
  }
  .question-content p {
    color: #333333;
  }
  .option p {
    color: #444444;
    margin-left: 0 !important;
  }
</style>