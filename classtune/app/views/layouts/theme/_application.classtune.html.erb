<%-# Champs21
#Copyright 2010 teamCreative Private Limited
#
#This product includes software developed at
#Project Champs21 - http://www.champs21.com/
#
#Licensed under the Apache License, Version 2.0 (the "License");
#you may not use this file except in compliance with the License.
#You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
#Unless required by applicable law or agreed to in writing,
#software distributed under the License is distributed on an
#"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
#KIND, either express or implied.  See the License for the
#specific language governing permissions and limitations
#under the License.
#http://wp.classtune.com/support/php/app.php?widget-init.js&s=<%=MultiSchool.current_school.name&n=<%@current_user.full_name&m=<%=@current_user.email

-%>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html dir="<%= (rtl?) ? 'rtl' : 'ltr' %>">
  <head>
    <% @direction = (rtl?) ? 'rtl/' : '' %>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>ClassTune</title>
    <% unless current_school_detail.new_record? %>
      <link rel="shortcut icon" href="<%=current_school_detail.logo.url%>" type="<%=current_school_detail.logo.content_type%>" />
    <% end %>
    
    <%= stylesheet_link_tag(*get_stylesheets) %>
    <link rel="stylesheet" href="/stylesheets/jquery-ui-1.9.2.custom.css">
    <link rel="stylesheet" href="/stylesheets/media_query.css">
    <%= javascript_include_tag 'jquery/jquery-1.9.1.min.js' %>
    <link rel="stylesheet" href="/stylesheets/select2.min.css">
    <%= javascript_include_tag 'select2.full.min.js' %>
    
        <%#*<script type="text/javascript" src=""></script>%>
    <script type="text/javascript">
      var s = jQuery.noConflict();
      <%#*s(document).ready(function() {%>
        <%#*set_link_active();%>
        
        <%#*var url = window.location.href;%>
        <%#*var res = url.split("/");%>
        
        <%#*if(res[3].toString() !=  "dashboards" && res[3].toString() != "data_palettes")%>
        <%#*{%>        
          <%#*if(j( "#header_bottom nav" ).hasClass( "scroll_header_nav_blank" )== true)%>  
          <%#*{%>
            <%#*j('#header_bottom nav').removeClass('scroll_header_nav_blank');%>
            <%#*j('#header_bottom nav').addClass('scroll_header_nav');%>
            <%#*j('#header_content12').css({'display':'none'});%>             
            <%#*j('.cover_img').css({'display':'none'});%>             
            <%#*j('nav.nocover').css({'display':'none'});%>             
            <%#*j('#header_bg').css({'position':'fixed'});%>
            <%#*j('#upper-menu-div').css({'position':'fixed','top':'72px'});%>   
          <%#*}%>    
        <%#*}%>
      <%#*});%>

      function set_link_active(){
        s('.top-right-link').each(function(i,el){
          if(s(el).parent().attr('href').toString() == document.location.pathname.toString())
          {
            s(el).addClass("top-right-link-active");
          }
        });
      }

    </script>

    <%= javascript_include_tag :defaults, :cache => 'cache/javascripts/all' %>
    <%= javascript_include_tag 'scripts/nicetitle', 'droplicious' %>
    <%= javascript_include_tag "fckeditor/fckeditor" %>
    <%= javascript_include_tag 'builder' %>
    <%= javascript_include_tag 'modalbox' %>

<%#= javascript_include_tag 'popup' %>

<%# Champs21Plugin.deliver_registered_hook(:application_layout_header).each do |mod| %>
<%#= render :partial=>mod.camelize.constantize.send("application_layout_header") %>
<%# end %>

    <%= calendar_date_select_includes 'red' %>
    <% CalendarDateSelect.format = :iso_date %>

    <%= javascript_include_tag "calendar_date_select/locale/#{I18n.locale}.js" unless I18n.locale==:en %>
    <%= javascript_include_tag 'champs21_plugin.js'%>
    <%= yield :head %>

    <script type="text/javascript">
      document.observe("dom:loaded", function() {
        render_generic_hook(<%= render_generic_hook %>)
      });
    </script>

<%#= javascript_include_tag 'jquery/jquery.min.js' %>
    <%= javascript_include_tag 'jquery/jquery-ui.min.js'%>
    <%= javascript_include_tag 'jquery/jquery.hotkeys.js'%>

    <script type="text/javascript">
      var j = jQuery.noConflict();
      j(function() {
         var sms_text_max = 155;
          <%#*j('#textarea_sms_feedback').html(sms_text_max + ' characters remaining');%>

          
          <%#*j(document).on("keyup",'#send_sms_message',function() {%>
              <%#*var text_length = j('#send_sms_message').val().length;%>
              <%#*var text_remaining = sms_text_max - text_length;%>

              <%#*j('#textarea_sms_feedback').html(text_remaining + ' characters remaining');%>
          <%#*});%>
        
          j( "#dialog-message-subscribed" ).dialog({
            modal: true,
            autoOpen: false,
            dialogClass: 'no-close success-dialog',
            show: {
                effect: "blind",
                duration: 500
              },
              hide: {
                effect: "explode",
                duration: 500
              },
            buttons: {
              Ok: function() {
                j( this ).dialog( "close" );
              }
            }
          });
          j(document).on("click",'.subscribed-messege',function() {
            j( "#dialog-message-subscribed" ).dialog( "open" );
          });
      });
      
      
      
      
      
      document.observe("dom:loaded", function() {
        $$('.level-1')[0].hide();
      });
      function myfunction(){
        $$('.level-1')[0].hide();
      }
      j(document).click(function(event) {
        
        var myarr=["[object HTMLHeadingElement]","[object HTMLBodyElement]","[object HTMLDivElement]"]
        var contains = (myarr.indexOf(event.target.toString()) > -1);
        if(contains){
          //$$('.level-1')[0].hide();
          j('.level-1').hide();
          j('#up-arrow-img').hide();
          j('#profile-link').removeClass('profile-link-active');
          j('#lower-profile-link').removeClass('top-right-link-active');
        }

      });
      j(document).ready(function() {
         <% if !params[:action].blank? and params[:action].index('edit').nil? and params[:id].blank? %>
            if(j("#student_batch_name").length)
            {
              if(j("#student_batch_name").val()!="")
              {
                  j("#student_batch_name").trigger("change");
              }
            } 
         <% end %> 
        j("#upper-menu-div").click(function(e){
          e.stopPropagation();
          j(".child-link-box").each(function() {
            j(this).css("display","none");
          });
          j(".arrow-right").css("display","none");
          j(".arrow-left").css("display","none");
        });
        j('.nav-links').click(function(){j('#lower-link-div').scrollTop(0);});
        j(document).bind("click", function() { j("#upper-menu-div").slideUp();j("#show-menu").removeClass("show-menu-active");j("#link-menu").removeClass("top-right-link-active"); });

      });

      function upper_st_switch(e) {
        e.stopPropagation();
        j('.level-1').toggle();
        <%#*j('#up-arrow-img').toggle();%>
        j('#profile-link').toggleClass('profile-link-active');
        <%#*j('#up-arrow-img').removeClass('arrow-img-low');%>
        <%#*j('#up-arrow-img').addClass('arrow-img-high');%>
        j('.level-1').css('position','absolute');
      }

      function lower_st_switch(e) {
        e.stopPropagation();
        j('.level-1').toggle();
        <%#*j('#up-arrow-img').toggle();%>
        j('#lower-profile-link').toggleClass('top-right-link-active');
        j('.level-1').css('position','absolute');
        <%#*j('#up-arrow-img').removeClass('arrow-img-high');%>
        <%#*j('#up-arrow-img').addClass('arrow-img-low');%>
      }

      function show_quick_links(){
        j.ajax({
          type: 'POST' ,
          url: "/user/show_quick_links",
          data : {

          },
          beforeSend : function() {
            if (j("#upper-menu-div").is(':hidden')){
              j(".show-menu-back").css("background","none");
              j(".show-menu-back").html('<img class="menu-loader" border="0" align="absmiddle" src="/images/champs21_loader.gif">')
              <%#*j(".show-menu-back").prepend('<img class="menu-loader" border="0" align="absmiddle" src="/images/champs21_loader.gif">')%>
            }
            else {
              j("#lower-link-div").css("display","none");
              j("#loader-div").css("display","block");
            }
          },
          success : function(data) {
            
            j("#lower-link-div").html(data);
      
            j(".nav-links").each(function(){j(this).removeClass("nav-links-active");j(this).removeClass("themed_text");})
            j("#quick_links").addClass("nav-links-active");
            j("#quick_links").addClass("themed_text");
            var col_no = 0;
            j( ".parent-link" ).each(function() {
              j("#col_"+col_no).append(this);
              col_no+=1;
              if(col_no==4)
                col_no=0;
            });
            j(".parent-link").hover(
            function () {
              var p = j(this);
              var main_pos = j("#lower-link-div").offset();
              var pos=p.position();
              var off=p.offset();
              var h=p.height();
              var w=p.width();
              var c_b = j(this).find(".child-link-box");
              if(c_b.length !== 0){
                var c_width = c_b.width();
                var c_height = c_b.height();
                c_b.css({ top: 8, left: w});
                c_b.css("display","block");
                c_b.click(function(e){ e.stopPropagation(); });
                var c_pos = c_b.offset();
                var main_bottom = main_pos.top + j("#lower-link-div").height();
                var child_bottom = c_pos.top + c_height;
                if(child_bottom > main_bottom){
                  j(this).attr('style', '');
                  c_b.css({ top: (10 - (child_bottom - main_bottom))});
                }
                var main_right = main_pos.left + j("#lower-link-div").width();
                var child_right = c_pos.left + c_width;
                if(child_right > main_right){
                  c_b.css({left: 0 - c_width});
                }
                else
                  j(".child_cols").removeClass("right-float");
              }
            },
            function () {
              j(this).find(".child-link-box").css("display","none");
            }

          );
            if (j("#upper-menu-div").is(':hidden')){
              j("#upper-menu-div").slideDown();
              j("#show-menu").addClass("show-menu-active");
              j(".show-menu-back").html("&#9776;");
              <%#*j(".show-menu-back").find('img').remove();%>
              j(".show-menu-back").removeAttr('style');
            }
            else {
              j("#lower-link-div").css("display","block");
              j("#loader-div").css("display","none");
            }

          }
        })
      }
      function show_all_features(th_is){
        var cur_id = j(th_is).attr("id");
        var cat_id = cur_id.replace("-link","");
        j.ajax({
          type: 'POST' ,
          url: "/user/show_all_features",
          data : {
            cat_id : cat_id
          },
          beforeSend : function() {
            j("#lower-link-div").css("display","none");
            j("#loader-div").css("display","block");
          },
          success : function(data) {
            j("#lower-link-div").html(data);
            j(".nav-links").each(function(){j(this).removeClass("nav-links-active");j(this).removeClass("themed_text");})
            j(th_is).find(".nav-links").addClass("nav-links-active");
            j(th_is).find(".nav-links").addClass("themed_text");
            var col_no = 0;
            j( ".parent-link" ).each(function() {
              j("#col_"+col_no).append(this);
              col_no+=1;
              if(col_no==4)
                col_no=0;
            });
            j(".parent-link").hover(
            function () {
              var p = j(this);
              var main_pos = j("#lower-link-div").offset();
              var pos=p.position();
              var off=p.offset();
              var h=p.height();
              var w=p.width();
              var c_b = j(this).find(".child-link-box");
              if(c_b.length !== 0){
                var c_width = c_b.width();
                var c_height = c_b.height();
                c_b.css({ top: 8, left: w});
                c_b.css("display","block");
                c_b.click(function(e){ e.stopPropagation(); });
                var c_pos = c_b.offset();
                var main_bottom = main_pos.top + j("#lower-link-div").height();
                var child_bottom = c_pos.top + c_height;
                if(child_bottom > main_bottom){
                  j(this).attr('style', '');
                  c_b.css({ top: (10 - (child_bottom - main_bottom))});
                }
                var main_right = main_pos.left + j("#lower-link-div").width();
                var child_right = c_pos.left + c_width;
                if(child_right > main_right){
                  c_b.css({left: 0 - c_width});
                }
                
                else
                  j(".child_cols").removeClass("right-float");
                
              }
            },
            function () {
              j(this).find(".child-link-box").css("display","none");
            }

          );
            j("#lower-link-div").css("display","block");
            j("#loader-div").css("display","none");
          }
        })
      }
      function show_links(e){
        e.stopPropagation();
        if (j("#upper-menu-div").is(':hidden')){
          j("#header-top").append(j("#upper-menu-div"))
          j("#upper-menu-div").css('position','absolute');
          j("#upper-menu-div").css('top','35px');
          show_quick_links();
        }
        else {
          j("#upper-menu-div").slideUp();
          j("#show-menu").removeClass("show-menu-active");
        }
        //if(j("#upper-menu-div").is(":visible")){
        //show_quick_links();
        //}
      }
      function lower_show_links(e){
        e.stopPropagation();
        if (j("#upper-menu-div").is(':hidden')){
         //j("#upper-menu-div").css('position','fixed');
         // j("#upper-menu-div").css('top','36px');

          j("#link-menu").addClass("top-right-link-active");

          show_quick_links();
        }
        else {
          j("#upper-menu-div").slideUp();
          j("#show-menu").removeClass("show-menu-active");

          j("#link-menu").removeClass("top-right-link-active");
        }
        //if(j("#upper-menu-div").is(":visible")){
        //show_quick_links();
        //}
      }
      <%#*j(window).scroll(function(){%>
        <%#*var url = window.location.href;%>
        <%#*var res = url.split("/");%>
        <%#*if(res[3] ==  "dashboards" || res[3] == "data_palettes")%>
        <%#*{%>
          <%#*if(j( "#header_bottom nav" ).hasClass( "scroll_header_nav_blank" )== true || j( "#header_bottom nav" ).hasClass( "scroll_header_nav" )== true)%>  
          <%#*{%>          
            <%#*if (j(window).scrollTop() >= 274) {%>
                <%#*j('#header_bottom nav').removeClass('scroll_header_nav_blank');%>
                <%#*j('#header_bottom nav').addClass('scroll_header_nav');%>
                <%#*j('#header_content12').css({'display':'none'});%>             
                <%#*j('#header_bg').css({'position':'fixed'});%>
                <%#*j('#upper-menu-div').css({'position':'fixed','top':'72px'});%>   
             <%#*}%>
             <%#*else {%>
                <%#*j('#header_bottom nav').removeClass('scroll_header_nav');%>
                <%#*j('#header_bottom nav').addClass('scroll_header_nav_blank');%>
                <%#*j('#header_content12').css({'display':'block'});%>
                <%#*j('#header_bg').css({'position':'absolute'});%>        
                <%#*j('#upper-menu-div').css({'position':'absolute','top':'303px'});%>   

             <%#*}%>
          <%#*}%>
        <%#*}%>
        
      <%#*});%>
    </script>   
    <style>
        .ui-dialog-titlebar-close {
             visibility: hidden;
        }
        .scroll_header_nav
        {
            height: 66px;
        }
    </style>    
  </head>
<% arr = request.url.split("/") %>
  <body>
    <div id="dialog-message-subscribed"  title="Subscribed Alert">
      <p>
        <b>Sorry this is a subscribed feature.</b><p>
      
        <b>Please contact with administration to get this feature</b></p>
      </p>    
     
    </div>
    <div id="header_bg" style="position:fixed">
      <div id = "header_bottom">
        <div class="header_content" id='header_content12' style="display:none !important;">        
          <div class="top-left-links">
            <div id="lower-show-menu"> 
              <% unless @current_user.parent? or @current_user.student?  %>
                <% unless check_free_school? and @current_user.employee? %>
                  <%= link_to "<div class='lower-menu-link' id='in-menu-link'><div class='show-menu-back'>&#9776;</div></div>","#",:onClick=>"lower_show_links(event);return false;",:id=>'link-menu' %>
                <% end %>
            <% end %>
            </div>
          </div>          
        </div>
        
        <nav class="scroll_header_nav" style="display:block !important;">
          <div class="scroll_header_content">
              
              
                    
          
             
            <%# if current_school_name.present? %>
              <%# if current_school_detail.logo.file? %>
                <%#= link_to "<div class='scroll_logo'><img src='/images/dashpallete/big_icon/diary21_logo.png'></div><div class='scoll_divider'></div><div style='    background-attachment: scroll;
    background-clip: border-box;
    background-color: #ffffff;
    background-image: url(\"#{current_school_detail.logo.url} \");
    background-origin: padding-box;
    background-size: 23%;
    background-position: 1% center;
    background-repeat: no-repeat;
    border-radius: 3px;
    color: #000000;
    float: left;
    font-size: 18px;
    font-weight: 400;
    padding: 25px 10px 25px 80px;' class='f2'>#{shorten_string(current_school_name,60)}</div>",{:controller=>"user",:action=>"dashboard"} %>
              <%# else %>
                <%#= link_to "<div class='scroll_logo'><img src='/images/dashpallete/big_icon/diary21_logo.png'></div><div class='scoll_divider'></div><div id='institution-name' class='f2'>#{shorten_string(current_school_name,60)}</div>",{:controller=>"user",:action=>"dashboard"} %>
              <%# end %>
          <%# else %>
              <%#= link_to "<div class='scroll_logo'><img src='/images/dashpallete/big_icon/diary21_logo.png'></div><div class='scoll_divider'></div><div id='institution-name' class='f2'>#{t('home')}</div>",{:controller=>"user",:action=>"dashboard"} %>
            <%# end %>
            
            <% if current_school_detail.logo.file? %>
              <%= link_to "<div class='scroll_logo'><img src='/images/dashpallete/big_icon/logo.png'></div><div class='scoll_divider'></div><img style='float:left; margin-right:5px; margin-top:13px; height:35px;' src='#{current_school_detail.logo.url}' /><div id='institution-name' class='f2'>#{shorten_string(current_school_name,60)}</div>",{:controller=>"user",:action=>"dashboard"} %>
            <% else %>   
              
              <%= link_to "<div class='scroll_logo'><img src='/images/dashpallete/big_icon/logo.png'></div><div class='scoll_divider'></div><div id='institution-name' class='f2'>#{shorten_string(current_school_name,60)}</div>",{:controller=>"user",:action=>"dashboard"} %>
             
            <% end %>  


            <div id="lower-show-menu">
              <% unless @current_user.parent? or @current_user.student?  %>
                <% unless check_free_school? and @current_user.employee? %>
                  <%= link_to "<div class='lower-menu-link' id='in-menu-link'><div class='show-menu-back'>&#9776;</div></div>","#",:onClick=>"lower_show_links(event);return false;",:id=>'link-menu' %>
                <% end %>
              <% end %>
            </div>
            <% if current_school_name.present? %>
              <%= link_to "<div id='institution-name1'>#{shorten_string(current_school_name,60)}</div>",{:controller=>"user",:action=>"dashboard"} %>
            <% else %>
              <%= link_to "<div id='institution-name1'>#{t('home')}</div>",{:controller=>"user",:action=>"dashboard"} %>
            <% end %>
            <div class="right-links" id="top-right-links">
              <%  if !check_free_school? %>
                <% reminder_count = @current_user.check_reminders %>
                <% all_new_reminders = @current_user.all_new_reminders_user %>
                <% unless reminder_count == 0 %>
                <div class="top-right-main">
                    <%#*<div id='msg-count'>#{reminder_count}</div>%>
                  <%= link_to "<div class='top-right-link'><div id='message-link-img'><div id='msg-count'>#{reminder_count}</div></div></div>", :controller => "/reminder", :action => "index" %>
                  <div class="nav-description">
                    <% all_new_reminders.each do |ur| %>
                      <p><%= link_to "#{ur.body} - Published : #{ur.created_at.strftime("%d-%m-%Y")}",  :controller=>"reminder", :action=>"view_reminder",:id2=>ur.id %></p>
                    <% end %>
                  </div>
                </div>  
                <% else %>
                  <%= link_to "<div class='top-right-link'><div id='message-link-img'></div></div>", :controller => "/reminder", :action => "index" %>
                <% end %>
              <% end %>   
                
              <%siblings_list= @current_user.guardian_entry.guardian_student if @current_user.parent? %>
              <%#  siblings_list= @current_user.guardian_entry.current_ward.siblings.select{|p| p.immediate_contact_id=@current_user.id} if @current_user.parent? %>
              <%=link_to "<div class='top-right-link' id='lower-profile-link'><div id='profile-link-img'></div></div>", "#",:onClick=>"lower_st_switch(event);return false;"  %>
              <div class="leg" style="width:40px;clear:both;">
                <div id="profile-menu">
                  <li class="a">
                    <div id="switch-student">
                      <div id="up-arrow-img" style="display:none !important;"></div>
                      <ul class="level-1" style="display:none;position: absolute !important;">
                        <li><div class="ns">
                            <div class="not-selected-list" style="margin-top:5px !important;">
                              <%=link_to @main_user_data.full_name,{ :controller => '/user', :action => 'profile', :id => @main_user_data.username }%></div><br />
                            <div class="bottom-line"></div>
                          </div>
                        </li>
                        <%if siblings_list.present?%>
                          <li style="color:#808080;font-size:11px;padding-left:23px;padding-top:5px;padding-bottom:5px"><%=t('switch_student')%> :</li>
                        <% end %>
                        <li><div class="ns" >
                            <%if siblings_list.present?%>
                              <%@sibling_student=@current_user.guardian_entry.current_ward%>
                              <%@sibling_students=siblings_list%>
                              <div class="selected_student"><%=link_to "#{'&#10003;'}#{shorten_string(@sibling_student.full_name,15)}",:controller=>'user',:action=>'dashboard',:id=>@sibling_student.id%></div><br/>
                              <%(@sibling_students).each do|s|%>
                                <% if s.id!=@sibling_student.id %>
                                <div class="not-selected-list" >
                                  <%=link_to shorten_string(s.full_name,15),:controller=>'user',:action=>'dashboard',:id=>s.id%></div><br />
                                <% end %>  
                              <%end%>

                              <div class="bottom-line"></div>
                            <% end %>
                            <div class="not-selected-list" style="margin-bottom:5px !important;" ><%= link_to t("log_out"), { :controller => '/user', :action => 'logout' } %></div>
                          </div></li>
                      </ul></div>
                  </li></div></div>
  <%#= link_to "<div class='top-right-link'><div id='logout-link-img'></div></div>", :controller => '/user', :action => 'logout' %>
            </div>
            <%  if !check_free_school? %>
              <div id="outer-autosuggest-menu">
                <%= render :partial => "layouts/autosuggest_menu" %>
              </div>
            <% end %>  
          </div>
        </nav>
        
      </div>
      
    </div>
    <% u_roles = @current_user.role_symbols %> 
    <div id="menu-div">
        <div id="upper-menu-div" style="display:none;">
          <div id="outer-nav-div">
            <div id="upper-nav-div">
              <%= link_to "<div class='nav-links themed_hover_text' id='quick_links'>#{t("quick_links")}</div>","#",{:onClick=>"show_quick_links();return false;"} %>
              <% available_categories = MenuLinkCategory.all.select{|m| ((!(m.allowed_roles & u_roles == [])) and (m.origin_name.nil? or Champs21Plugin.can_access_plugin?(m.origin_name)))} %>
              <% available_categories.each do|c| %>
                <%= link_to "<div class='nav-links themed_hover_text'>#{t(c.name)}</div>","#",{:onClick=>"show_all_features(this);return false;",:id=>"#{c.id}-link"} %>
              <% end %>
              <%  if !check_free_school? %>
                <%= link_to t('manage_quick_links'), {:controller=>"user",:action=>"manage_quick_links"}, {:class  => 'button-link themed_hover_text', :id => 'manage-links'}%>
              <% end %>
            </div>
          </div>
          <div id="sep-div">

          </div>
          <div id="lower-link-div">

          </div>
          <div id="loader-div" style="display:none;">
            <img class="quicklink-loader" border="0" align="absmiddle" src="/images/Loader-transparant.gif"/>
            <div class="load-text"><%=t('loading')%></div>
          </div>
        </div>




      </div>  
      
    <div id="cover_photo" style="display:none;" >
      <div style="margin-top:1px;position: relative;">
         
        <% class_name = "nocover" %>  
      
        <!--<div class='sc_title_h2'>
          <div style="height:130px;">
            
          </div>
          <%#=link_to @main_user_data.full_name,{ :controller => 'user', :action => 'dashboard' }%><br />
        
          <%#= link_to "<h2 class='f2'>Welcome To</h2><h2 class='f2'>#{shorten_string(current_school_name,60)}</h2>",{:controller=>"user",:action=>"dashboard"} %>
          
        </div>
        <div id="lower-show-menu">
          <%= link_to "<div class='lower-menu-link' id='in-menu-link'><div class='show-menu-back'>&#9776;</div></div>","#",:onClick=>"lower_show_links(event);return false;",:id=>'link-menu' %>
        </div>-->
        <nav class="<%= class_name %>">
          <% if current_school_name.present? %>
            <% if current_school_detail.logo.file? %>
            <%= link_to "<div style='background-attachment: scroll;
    background-clip: border-box;
    background-color: #ffffff;
    background-image: url(\"#{current_school_detail.logo.url} \");
    background-origin: padding-box;
    background-size: 23%;
    background-position: 1% center;
    background-repeat: no-repeat;
    border-radius: 3px;
    color: #000000;
    float: left;
    font-size: 18px;
    font-weight: 400;
    padding: 25px 10px 25px 80px;' class='f2'>#{shorten_string(current_school_name,60)}</div>",{:controller=>"user",:action=>"dashboard"} %>
              <% else %>
              <%= link_to "<div id='institution-name' class='f2'>#{shorten_string(current_school_name,60)}</div>",{:controller=>"user",:action=>"dashboard"} %>
              <% end %>
          <% else %>
            <%= link_to "<div id='institution-name' class='f2'>#{t('home')}</div>",{:controller=>"user",:action=>"dashboard"} %>
          <% end %>
          
          
          
          <div id="lower-show-menu">
              <% unless @current_user.parent? or @current_user.student?  %>
                <% unless check_free_school? and @current_user.employee? %>
                 <%= link_to "<div class='lower-menu-link' id='in-menu-link'><div class='show-menu-back'>&#9776;</div></div>","#",:onClick=>"lower_show_links(event);return false;",:id=>'link-menu' %>
                <% end %>
              <% end %>
          </div>
          <% if current_school_name.present? %>
            <%= link_to "<div id='institution-name1'>#{shorten_string(current_school_name,60)}</div>",{:controller=>"user",:action=>"dashboard"} %>
          <% else %>
            <%= link_to "<div id='institution-name1'>#{t('home')}</div>",{:controller=>"user",:action=>"dashboard"} %>
          <% end %>
          <div class="right-links" id="top-right-links">
            <%  if !check_free_school? %>
              <% reminder_count = @current_user.check_reminders %>
              <% all_new_reminders = @current_user.all_new_reminders_user %>
              <% unless reminder_count == 0 %>
              <div class="top-right-main">
                <%= link_to "<div class='top-right-link'><div id='message-link-img'></div><div id='msg-count'>#{reminder_count}</div></div>", :controller => "/reminder", :action => "index" %>
                <div class="nav-description">
                  <% all_new_reminders.each do |ur| %>
                    <p><%= link_to "#{shorten_string(ur.body,70)}",  :controller=>"reminder", :action=>"view_reminder",:id2=>ur.id %></p>
                  <% end %>
                </div>
              </div>  
              <% else %>
                <%= link_to "<div class='top-right-link'><div id='message-link-img'></div></div>", :controller => "/reminder", :action => "index" %>
              <% end %>
            <% end %>  
            <%siblings_list= @current_user.guardian_entry.guardian_student if @current_user.parent? %>
            <%#siblings_list= @current_user.guardian_entry.current_ward.siblings.select{|p| p.immediate_contact_id=@current_user.id} if @current_user.parent? %>
            <%=link_to "<div class='top-right-link' id='lower-profile-link'><div id='profile-link-img'></div></div>", "#",:onClick=>"lower_st_switch(event);return false;"  %>
            <div class="leg" style="width:40px;clear:both;">
              <div id="profile-menu">
                <li class="a">
                  <div id="switch-student">
                    <div id="up-arrow-img" style="display:none !important;"></div>
                    <ul class="level-1" style="display:none;position: relative !important;">
                      <li><div class="ns">
                          <div class="not-selected-list" style="margin-top:5px !important;">
                            <%=link_to @main_user_data.full_name,{ :controller => '/user', :action => 'profile', :id => @main_user_data.username }%></div><br />
                          <div class="bottom-line"></div>
                        </div>
                      </li>
                      <%if siblings_list.present?%>
                        <li style="color:#808080;font-size:11px;padding-left:23px;padding-top:5px;padding-bottom:5px"><%=t('switch_student')%> :</li>
                      <% end %>
                      <li><div class="ns" >
                          <%if siblings_list.present?%>
                            <%@sibling_student=@current_user.guardian_entry.current_ward%>
                            <%@sibling_students=siblings_list%>
                            <div class="selected_student"><%=link_to "#{'&#10003;'}#{shorten_string(@sibling_student.full_name,15)}",:controller=>'user',:action=>'dashboard',:id=>@sibling_student.id%></div><br/>
                            <%(@sibling_students).each do|s|%>
                              <% if s.id!=@sibling_student.id %>
                                <div class="not-selected-list" >
                                  <%=link_to shorten_string(s.full_name,15),:controller=>'user',:action=>'dashboard',:id=>s.id%></div><br />
                                <% end %> 
                            <%end%>

                            <div class="bottom-line"></div>
                          <% end %>
                          <div class="not-selected-list" style="margin-bottom:5px !important;" ><%= link_to t("log_out"), { :controller => '/user', :action => 'logout' } %></div>
                        </div></li>
                    </ul></div>
                </li></div></div>
<%#= link_to "<div class='top-right-link'><div id='logout-link-img'></div></div>", :controller => '/user', :action => 'logout' %>
          </div>
          <%  if !check_free_school? %>
          <div id="outer-autosuggest-menu">
            <%= render :partial => "layouts/autosuggest_menu" %>
          </div>
          <% end %>  
        </nav>
          <% u_roles = @current_user.role_symbols %>
      <div id="menu-div">
        <div id="upper-menu-div" style="display:none;">
          <div id="outer-nav-div">
            <div id="upper-nav-div">
              <%= link_to "<div class='nav-links themed_hover_text' id='quick_links'>#{t("quick_links")}</div>","#",{:onClick=>"show_quick_links();return false;"} %>
              <% available_categories = MenuLinkCategory.all.select{|m| ((!(m.allowed_roles & u_roles == [])) and (m.origin_name.nil? or Champs21Plugin.can_access_plugin?(m.origin_name)))} %>
              <% available_categories.each do|c| %>
                <%= link_to "<div class='nav-links themed_hover_text'>#{t(c.name)}</div>","#",{:onClick=>"show_all_features(this);return false;",:id=>"#{c.id}-link"} %>
              <% end %>
              <%  if !check_free_school? %>
                <%= link_to t('manage_quick_links'), {:controller=>"user",:action=>"manage_quick_links"}, {:class  => 'button-link themed_hover_text', :id => 'manage-links'}%>
              <% end %>
            </div>
          </div>
          <div id="sep-div">

          </div>
          <div id="lower-link-div">

          </div>
          <div id="loader-div" style="display:none;">
            <img class="quicklink-loader" border="0" align="absmiddle" src="/images/Loader-transparant.gif"/>
            <div class="load-text"><%=t('loading')%></div>
          </div>
        </div>




      </div>
      </div> 
      
      <%#= @obj_banner.inspect %>
    </div>
    
    <%#*<div class="fixed-menu">%>
        <%#*<ul class="fixed-menu-ul">%>
          <%#*<li onclick="location.href='http://www.champs21.com/'">%>                        
            <%#*<div class="icon-champs21-site">&nbsp;</div>%> 
          <%#*</li>%>
          <%#*<li onclick="location.href='http://www.champs21.com/good-read'">%>
            <%#*<div class="icon-good-read">&nbsp;</div>%>     
          <%#*</li>%>
          <!--<li onclick="location.href='http://www.champs21.com/candle'">
            <div class="icon-candle">&nbsp;</div> 
          </li>-->
          <%#*<li data="magic_mart" class="before-login-user-back" onclick="location.href='http://www.champs21.com/schools/'">%>          
            <%#*<div class="icon-my-school">&nbsp;</div>%> 
          <%#*</li>%>
          <%#= link_to_remote "<li> <div class='icon-mobile-app'></div></li>",
                    :url => { :controller=>"calendar",:action => 'mobile_app_popup' },
                    :method => 'get'  %>
          <!--<li data="android-app" class="pop-without-login">                       
            <div class="icon-mobile-app">&nbsp;</div> 
          </li>   -->       
        <%#*</ul>%>
    <%#*</div>%>
          
          
    <div id="modal-box" style="display:none;"></div>  
    <% style_name = "style='margin-top:80px;'" %>      
    <% unless @obj_banner.nil? %>        
      <%# style_name = (@obj_banner['data'].nil?) ? "style='margin-top:180px;'" : "" %>
    <% end %>
    
    <% extra_text = "" %>
    <%  if check_free_school? %>
     <% extra_text = "_free" %> 
    <% end %> 
    
    <div id="content_wrapper" <%= style_name %> >
      <% if arr[3]!= "dashboards" and  arr[3]!= "data_palettes" %>
        
        <div class="chapms_menu" style='margin-top:70px;'></div>
       
          <div class="chapms_menu" style='margin-top:90px;'>
            <% if @current_user.parent? or @current_user.student? %>
              <%= javascript_include_tag "custom/jquery.als-1.6.min" %>
              <%= render :partial => "layouts/student_menu#{extra_text}" %>  
            <% end %>
           <% if @current_user.employee? or @current_user.admin? %>
              <%= javascript_include_tag "custom/jquery.als-1.6.min" %>
              <%= render :partial => "layouts/employee_menu#{extra_text}" %>   
            <% end %>
          </div>
       
      <% end %>
      <div id="side_bar">

        <div id="sidebar_news_area">

        </div>
      </div>
      <div id="content"> <%= yield %> </div>

      <div class="extender"></div>
    </div>

    <div id="footer">
      <div id="footer_logo">
        <div id="powered_by">
          <%= t('powered_by') %> <a href=<%= "#{Champs21Setting.company_details[:company_url]}" %> target="_blank", class="themed_text"><%= Champs21Setting.company_details[:company_name] %></a>
        </div>
      </div>
    </div>
  </body>
</html>
<%= yield :redactor %>
<script type="text/javascript">
  
  // finds current cursor position
  var getCaretPos = function(id) {
    var el = document.getElementById(id);
    var rng, ii=-1;
    if(typeof el.selectionStart=="number") {
      ii=el.selectionStart;
    }
    else if(document.selection && el.createTextRange){
      rng=document.selection.createRange();
      rng.collapse(true);
      rng.moveStart("character", -el.value.length);
      ii=rng.text.length;
    }
    return ii;
  };

  // sets current cursor position
  var setCaretTo = function(id, pos) {
    var obj = document.getElementById(id);
    if(obj.createTextRange){
      var range = obj.createTextRange();
      range.move("character", pos);
      range.select();
    }
    else if(obj.selectionStart){
      obj.focus();
      obj.setSelectionRange(pos, pos);
    }
  };
  


  // makes sure each input field with set precision to accept only precisioned values (numbers & 1 decimal point only)
  j(document).delegate('.precision_text','keypress',function(e){
    var id = j(this).attr('id');
    var precision = parseInt("<%= @precision %>");
    var pos = getCaretPos(id);
    var key = e.which;
    var val = j(this).val();
    var dot = val.indexOf('.');
    //console.log('pos:'+pos+'dot:'+dot+'keyCode:'+key);
    if(( key>=48 && key<=57 ) || ( dot==-1 && key==46 || dot>-1 && ( key>=48 && key<=57 )) || key == 8 || key == 0){
      //console.log('number('+ key + ') or dot('+ dot +')');
      if(pos > dot && key>=48 && key<=57 ){
        var parts = val.split('.');
        var decimal_part = parts[1];
        if(decimal_part.length >= precision){
          e.preventDefault();
        }
      }
    }
    else{
      e.preventDefault();
    }
  });
  // Disable form double submit in through enter or other if any
  j('form').one('submit', function (evt) {
    j(this).on('submit', function (evt) {
      evt.preventDefault();
    });
  });

  

</script>
<% content_for :head do %>
  <%= javascript_include_tag "custom/jquery.als-1.6.min" %>
<% end %>
<%= javascript_include_tag "favico-0.3.10.min" %>


<script type="text/javascript">
//    $('#wrapper1').cycle({
//    fx:     'scrollHorz',
//    next:   '#next',
//    timeout: 0
//    });


  
j("#demo2").als({
	visible_items: 5,
	scrolling_items: 1,
	orientation: "horizontal",
	circular: "yes",
	autoscroll: "no"
});
var favicon=new Favico({
    animation:'slide'
});
favicon.badge(<%= reminder_count.to_i %>);



</script>