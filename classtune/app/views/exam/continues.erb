<% if !@report_data.blank? %>
  
  <% @all_subject_exam = @report_data['report']['subjects'] %>
  <% @all_student_subject = StudentsSubject.find_all_by_batch_id(@batch.id) %>
  <% @total_std_in_class = @report_data['report']['students'].count %>
  
  <% @report_data['report']['students'].each do |std| %>
    <%
    subjects_new = []
    subjects_ids = []
    unless @all_subject_exam.blank? 
      @all_subject_exam.each do |subjects|
        if subjects['elective_group_id'].to_i!=0 && MultiSchool.current_school.id!=319 && MultiSchool.current_school.id!=324 && MultiSchool.current_school.code!="ess"
          @all_student_subject.each do |sub_std|
            if subjects['id'].to_i == sub_std.subject_id and std['id'].to_i == sub_std.student_id and !subjects_ids.include?(subjects['id'].to_i)
              subjects_new << subjects
              subjects_ids << subjects['id'].to_i
            end 
          end 
        elsif !subjects_ids.include?(subjects['id'].to_i)
          subjects_new << subjects 
          subjects_ids << subjects['id'].to_i
        end 
      end
      end
    @report_data['report']['subjects'] = subjects_new
    unless @student_main_id.blank?
      if @student_main_id.to_i != std['id'].to_i
        next
      end  
    end 
    @student = Student.find_by_id(std['id'].to_i,:include=>["student_category"])

    unless @student.blank?
      
      @report_data['report']['no_exam_subject_resutl'] = []
      @report_data['report']['exams'] = []
      @report_data['report']['comments'] = []
      @report_data['report']['comments2'] = []
      @report_data['present'] = 0;
      if !@report_data['report']['all_result'][std['id']]['exams'].blank?


        @report_data['report']['exams'] = @report_data['report']['all_result'][std['id']]['exams']
        if !@report_data['total_new'].blank? and !@report_data['total_new'][std['id']].blank?
          @report_data['total_new_std'] = @report_data['total_new'][std['id']]
          @report_data['total'] = @report_data['total_new'][std['id']]
        end 
      
        if !@report_data['report']['exam_comments'].blank? and !@report_data['report']['exam_comments'][std['id']]['comments'].blank?
          @report_data['report']['comments'] = @report_data['report']['exam_comments'][std['id']]['comments']
        end
        if !@report_data['report']['exam_comments'].blank? and !@report_data['report']['exam_comments'][std['id']]['comments2'].blank?
          @report_data['report']['comments2'] = @report_data['report']['exam_comments'][std['id']]['comments2']
        end
      
        if !@report_data['report']['no_exam_comments'].blank? and !@report_data['report']['no_exam_comments'][std['id']]['no_exam_subject_resutl'].blank?
          @report_data['report']['no_exam_subject_resutl'] = @report_data['report']['no_exam_comments'][std['id']]['no_exam_subject_resutl']
        end 

        if !@report_data['present_all'].blank? and !@report_data['present_all'][std['id']].blank? and 
          @report_data['present'] = @report_data['present_all'][std['id']]
        end 
      
        if !@report_data['absent_all'].blank? and !@report_data['absent_all'][std['id']].blank?
          @report_data['absent'] = @report_data['absent_all'][std['id']]
        end 
      
        if !@report_data['first_term_total'].blank?
          @report_data['total_first_term'] = @report_data['first_term_total']
        end 
        if !@report_data['first_term_present_all'].blank? and !@report_data['first_term_present_all'][std['id']].blank?
          @report_data['present_first_term'] = @report_data['first_term_present_all'][std['id']]
        end
        if !@report_data['first_term_absent_all'].blank? and !@report_data['first_term_absent_all'][std['id']].blank?
          @report_data['absent_first_term'] = @report_data['first_term_absent_all'][std['id']]
        end
        if !@report_data['first_term_total_new'].blank? and !@report_data['first_term_total_new'][std['id']].blank?
          @report_data['total_new_std_first_term'] = @report_data['first_term_total_new'][std['id']]
          @report_data['total_first_term'] = @report_data['first_term_total_new'][std['id']]
        end
      
        

        @exam_comment = {}
        @exam_comment_all.each do |ec|
          if ec.student_id.to_i == @student.id.to_i
            @exam_comment = ec
            break
          end
        end
      %>



        <%= render :file => '/exam/generated_report5_pdf' %>
        <% unless std.equal? @report_data['report']['students'].last or !@student_main_id.blank? %>
          <div class="page-break-main"></div>
        <% end %>
      <% end %>
    <% end %>

  <% end %>
<% end %>