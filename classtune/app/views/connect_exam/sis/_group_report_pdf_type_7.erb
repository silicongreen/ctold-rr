<% unless @report_data.blank?  or  @report_data['report'].blank? %>

  <div id="page-yield"  class="available_sections1 sis sis-final">
      <div class="section1 row" >
          <center>
            <div id="pdf-header-south" class="general-header">
                <h4 align="center" class="height-50">
                <% unless @covid_main.blank? %>
                  <% if @batch.course.course_name.upcase.index("PLAYGROUP").nil? and @batch.course.course_name.upcase.index("NURSERY").nil? and @batch.course.course_name.upcase.index("PG").nil? and  @batch.course.course_name.upcase.index("KG").nil? %>
                    <%= wicked_pdf_image_tag "/"+("#{Rails.root}/"+ ("public/images/school_logo/348/summer.jpg")),:width=> '40%' %>
                  <% else %>
                    <%= wicked_pdf_image_tag "/"+("#{Rails.root}/"+ ("public/images/school_logo/348/tinytots.png")),:width=> '40%' %>
                  <% end %>
                <% else %>
                    &nbsp;
                <% end %>    
                </h4> 
                <h2 align="center"><%= @batch.course.course_name %>: <%= @connect_exam_obj.name %></h2>
            </div>
          </center>
      </div>
      <div class="student_information">
        <table class="std_info_table" width="99.5%" cellspacing="0">
          <tr>
              <td>NAME </td><td colspan="3" class="font-dark">:&nbsp;&nbsp;<%= @student.full_name %></td>
              <td>SHIFT </td><td colspan="3" class="font-dark">:&nbsp;&nbsp;<%= @batch.name %></td>
          </tr>
          <tr>
              <td>DATE OF BIRTH </td><td colspan="3" class="font-dark">:&nbsp;&nbsp;<%= I18n.l(@student.date_of_birth,:format=>"%d %B %Y") unless @student.date_of_birth.nil? %></td>
              <td>DATE </td><td colspan="3" class="font-dark">:&nbsp;&nbsp;<%= I18n.l(@connect_exam_obj.published_date,:format=>"%d %B %Y") %></td>
          </tr>
        </table>
      </div>
      
      <% year_month = I18n.l(@connect_exam_obj.published_date,:format=>"%Y-%m") %>
      <% if year_month.to_s == "2020-07" or year_month.to_s == "2020-08" or year_month.to_s == "2020-09" or year_month.to_s == "2020-10" %>
        <% covid = 1 %>
      <% end %>
     
      
      <div class ="current_batch" style="margin-left:0px;">
          <div id="grouped_exam_report">
                  <% unless @report_data['report']['subjects'].blank? %>
                    <% c = 'even' %>
                    <% sub_loop = 0 %>
                    <% group_one_loop = 0 %>
                    <% total_subject = @report_data['report']['subjects'].count %>
                    <% per_group = total_subject.to_f/2 %>
                    <% if @batch.course.course_name.upcase == "NURSERY" %>
                      <% per_group = per_group.floor %>
                    <% else %>
                      <% per_group = per_group.round %>
                    <% end %>
                    <table id="pdf-table" width="48%" class="left-table even-table left-table-nursery" cellspacing="0">
                    <% @report_data['report']['subjects'].each do |subjects| %>
                      
                      <% sub_loop +=1  %>
                      <% if sub_loop > per_group %>
                        <% break %>
                      <% end %>
              
                    
                      
                      
                      <tr class="odd group_one">
                          
                          <td class="col-pdf no-warp align-left" colspan="2"><b><%= subjects['name'].upcase %></b></td>   
                          <% group_one_loop = group_one_loop+1 %>
                      </tr> 
                      
                        <% if has_subject_group(subjects['id'].to_i,@connect_exam_obj.quarter_number) %>
                          <% iloop = 0 %>
                          <% subject_groups = get_subject_group(subjects['id'].to_i,@connect_exam_obj.quarter_number) %>
                              <% subject_groups.each do |group_name| %>
                                <% subject_subgroup = get_subject_sub_group(group_name.id,@connect_exam_obj.quarter_number) %>
                                <% unless subject_subgroup.blank? %>
                                   <% group_one_loop = group_one_loop+1 %> 
                                   <tr class="odd subgroup group_one">
                                    <td class="col-pdf no-warp align-left"><b><%= group_name.name %></b></td>
                                    <td class="col-pdf no-warp align-left"></td>
                                   </tr>
                                    <% subject_subgroup.each do |sub_group_name| %>
                                       <% @report_data['report']['exams'].each do |report| %>
                                        <% if report['exam_category'] == '7' %>
                                            <% next %>
                                        <% end %>
                                        <% if !report['result'][report['exam_id']].blank? and !report['result'][report['exam_id']][subjects['id']].blank? and !report['result'][report['exam_id']][subjects['id']]['remarks'].blank?  %>
                                          <% group_one_loop = group_one_loop+1 %>
                                          <tr class="even subgroup group_one">
                                          <td class="col-pdf no-warp align-left"><%= sub_group_name %></td>
                                          <% wordString = report['result'][report['exam_id']][subjects['id']]['remarks'] %>
                                          <% wordString_split = wordString.split("|") %>
                                          <% unless wordString_split[iloop.to_i].blank? %>
                                              <td class="col-pdf no-warp"><b><%= wordString_split[iloop.to_i].to_s %></b></td>
                                              
                                          <% else %>
                                            <td class="col-pdf no-warp align-left"></td>
                                          <% end %>
                                          </tr> 
                                          <% break %>
                                        <% else %>
                                            <tr class="even subgroup group_one">
                                              <td class="col-pdf no-warp align-left"><%= sub_group_name %></td>
                                             <td class="col-pdf no-warp align-left"></td> 
                                            </tr>
                                            <% break %>
                                         <% end %>
                                      <% end %>    
                                      <% iloop+=1 %> 
                                    <% end %>
                                <% else %>
                                    <% group_one_loop = group_one_loop+1 %>
                                    <tr class="odd subgroup group_one">
                                    <td class="col-pdf no-warp align-left"><%= group_name.name %></td>
                                    <% @report_data['report']['exams'].each do |report| %>
                                       <% if report['exam_category'] == '7' %>
                                          <% next %>
                                      <% end %>
                                       <% if !report['result'][report['exam_id']].blank? and !report['result'][report['exam_id']][subjects['id']].blank? and !report['result'][report['exam_id']][subjects['id']]['remarks'].blank?  %>
                                          <% wordString = report['result'][report['exam_id']][subjects['id']]['remarks'] %>
                                          <% wordString_split = wordString.split("|") %>
                                          <% unless wordString_split[iloop.to_i].blank? %>
                                              <td class="col-pdf no-warp"><b><%= wordString_split[iloop.to_i].to_s %></b></td>
                                              
                                          <% else %>
                                            <td class="col-pdf no-warp align-left"></td>
                                          <% end %>
                                       <% else %>
                                           <td class="col-pdf no-warp align-left"></td> 
                                       <% end %>     
                                    <% end %>
                                    </tr>          
                                    <% iloop+=1 %> 
                                <% end %>
                                 
                          <% end %>
                        <% end %>           
                      
                    <% end %> 
                    </table>
                    <% sub_loop = 0 %>
                    <% group_two_loop = 0 %>
                    <table id="pdf-table" width="47.5%" class="left-table odd-table" cellspacing="0">
                    <% @report_data['report']['subjects'].each do |subjects| %>
                      
                      <% sub_loop +=1  %>
                      <% if sub_loop <= per_group %>
                        <% next %>
                      <% end %>
              
                        
                      
                      <% group_two_loop = group_two_loop+1 %>
                      <tr class="odd group_two">
                          
                          <td class="col-pdf no-warp align-left" colspan="2"><b><%= subjects['name'].upcase %></b></td>   

                      </tr> 
                      
                        <% if has_subject_group(subjects['id'].to_i,@connect_exam_obj.quarter_number) %>
                          <% iloop = 0 %>
                          <% subject_groups = get_subject_group(subjects['id'].to_i,@connect_exam_obj.quarter_number) %>
                              <% subject_groups.each do |group_name| %>
                                <% subject_subgroup = get_subject_sub_group(group_name.id,@connect_exam_obj.quarter_number) %>
                                <% unless subject_subgroup.blank? %>
                                    <% group_two_loop = group_two_loop+1 %>
                                   <tr class="odd group_two">
                                    <td class="col-pdf no-warp align-left"><b><%= group_name.name %></b></td>
                                    <td class="col-pdf no-warp align-left"></td>
                                   </tr>
                                    <% subject_subgroup.each do |sub_group_name| %>
                                       <% @report_data['report']['exams'].each do |report| %>
                                        <% if report['exam_category'] == '7' %>
                                            <% next %>
                                        <% end %>
                                        <% if !report['result'][report['exam_id']].blank? and !report['result'][report['exam_id']][subjects['id']].blank? and !report['result'][report['exam_id']][subjects['id']]['remarks'].blank?  %>
                                          <% group_two_loop = group_two_loop+1 %>
                                          <tr class="even group_two">
                                          <td class="col-pdf no-warp align-left"><%= sub_group_name %></td>
                                          <% wordString = report['result'][report['exam_id']][subjects['id']]['remarks'] %>
                                          <% wordString_split = wordString.split("|") %>
                                          <% unless wordString_split[iloop.to_i].blank? %>
                                              <td class="col-pdf no-warp"><b><%= wordString_split[iloop.to_i].to_s %></b></td>
                                              
                                          <% else %>
                                            <td class="col-pdf no-warp align-left"></td>
                                          <% end %>
                                          </tr> 
                                          <% break %>
                                        <% else %>
                                            <% group_two_loop = group_two_loop+1 %>
                                            <tr class="even group_two">
                                              <td class="col-pdf no-warp align-left"><%= sub_group_name %></td>
                                             <td class="col-pdf no-warp align-left"></td> 
                                            </tr>
                                            <% break %>
                                         <% end %>
                                      <% end %>    
                                      <% iloop+=1 %> 
                                    <% end %>
                                <% else %>
                                     <% group_two_loop = group_two_loop+1 %>
                                    <tr class="odd group_two">
                                    <td class="col-pdf no-warp align-left"><%= group_name.name %></td>
                                    <% @report_data['report']['exams'].each do |report| %>
                                      <% if report['exam_category'] == '7' %>
                                          <% next %>
                                      <% end %>
                                       <% if !report['result'][report['exam_id']].blank? and !report['result'][report['exam_id']][subjects['id']].blank? and !report['result'][report['exam_id']][subjects['id']]['remarks'].blank?  %>
                                          <% wordString = report['result'][report['exam_id']][subjects['id']]['remarks'] %>
                                          <% wordString_split = wordString.split("|") %>
                                          <% unless wordString_split[iloop.to_i].blank? %>
                                              <td class="col-pdf no-warp"><b><%= wordString_split[iloop.to_i].to_s %></b></td>
                                              
                                          <% else %>
                                            <td class="col-pdf no-warp"></td>
                                          <% end %>
                                       <% else %>
                                           <td class="col-pdf no-warp"></td> 
                                       <% end %>     
                                    <% end %>
                                    </tr>          
                                    <% iloop+=1 %> 
                                <% end %>
                                 
                          <% end %>
                        <% end %>           
                      
                    <% end %> 
                    </table>
                  <% end %> 
               
                <div class='line'></div>
                <table id="pdf-table" width="23.5%" class="left-table even-table" cellspacing="0">
                      <% class_grade = "height-55" %>
                    <% if @connect_exam_obj.quarter_number == 5 %>
                      <% class_grade = "height-40" %>
                    <% end %>
                     <tr class="<%= cycle(c,(["odd","even"]-[c]).first) %>">
                      <td class="col-pdf no-warp align-left"><b>A</b></td>
                      <td class="col-pdf no-warp align-left <%= class_grade %>"><b>Excellent</b></td>
                     </tr>
                     <tr class="<%= cycle(c,(["odd","even"]-[c]).first) %>">
                      <td class="col-pdf no-warp align-left"><b>B+</b></td>
                      <td class="col-pdf no-warp align-left  <%= class_grade %>"><b>Very Good</b></td>
                     </tr>
                     <tr class="<%= cycle(c,(["odd","even"]-[c]).first) %>">
                      <td class="col-pdf no-warp align-left"><b>B</b></td>
                      <td class="col-pdf no-warp align-left  <%= class_grade %>"><b>Good</b></td>
                     </tr>
                     <% if @batch.course.course_name.upcase == "NURSERY" %>
                     <tr class="<%= cycle(c,(["odd","even"]-[c]).first) %>">
                      <td class="col-pdf no-warp align-left"><b>NI</b></td>
                      <td class="col-pdf no-warp align-left  <%= class_grade %>"><b>Needs Improvement</b></td>
                     </tr>
                     <% end %>
              
                </table>
                <table id="pdf-table" width="72%" class="left-table odd-table signature_table" cellspacing="0">
                    <% if @covid_main == 0 %>
                    <tr class="<%= cycle(c,(["odd","even"]-[c]).first) %>">
                      <td class="col-pdf no-warp align-left"><b>Class Teacher</b></td>
                      <td class="col-pdf no-warp align-left width-60"><br/></td>
                     </tr>
                     <% end %>
                     <tr class="<%= cycle(c,(["odd","even"]-[c]).first) %>">
                      <td class="col-pdf no-warp align-left"><b>Section-in-charge</b></td>
                      <td class="col-pdf no-warp align-left width-60"><% if @covid_main == 1 %>
                          <%= wicked_pdf_image_tag "/"+("#{Rails.root}/"+ ("public/images/school_logo/348/#{@section_in_charge}.png")), :width=>"30%" %>
                      <% end %></td>
                     </tr>
                     <% if @covid_main == 0 %>
                      <% if @batch.course.course_name.upcase == "NURSERY" %>
                      <tr class="<%= cycle(c,(["odd","even"]-[c]).first) %>">
                       <td class="col-pdf no-warp align-left"><b>Principal</b></td>
                       <td class="col-pdf no-warp align-left width-60"><br/></td>
                      </tr>
                      <% end %>
                     <% end %>
                    <% if @covid_main == 0 %>
                     <tr class="<%= cycle(c,(["odd","even"]-[c]).first) %>">
                      <td class="col-pdf no-warp align-left"><b>Parent's Signature</b></td>
                      <td class="col-pdf no-warp align-left width-60"><br/></td>
                     </tr>
                    <% end %> 
                     <% if @connect_exam_obj.quarter_number == 5 %>
                     <tr class="<%= cycle(c,(["odd","even"]-[c]).first) %>">
                      <td class="col-pdf no-warp align-left"><b>Next term begins on </b></td>
                      <td class="col-pdf no-warp align-left width-60"><%= @connect_exam_obj.next_session_begins.blank?  ? "" : I18n.l(@connect_exam_obj.next_session_begins,:format=>"%d %B %Y") %></td>
                     </tr>
                     <% else %>
                     <tr class="<%= cycle(c,(["odd","even"]-[c]).first) %>">
                      <td class="col-pdf no-warp align-left"><b>Promoted to </b></td>
                      <td class="col-pdf no-warp align-left width-60"><%= @connect_exam_obj.promoted_to %></td>
                     </tr>
                     <tr class="<%= cycle(c,(["odd","even"]-[c]).first) %>">
                      <td class="col-pdf no-warp align-left"><b>Next session begins on </b></td>
                      <td class="col-pdf no-warp align-left width-60"><%= @connect_exam_obj.next_session_begins.blank?  ? "" : I18n.l(@connect_exam_obj.next_session_begins,:format=>"%d %B %Y") %></td>
                     </tr>
                     <% end %>
                </table>

              

          </div>
      </div>



  </div>

<% end %>

<% 
if group_one_loop > group_two_loop
  diff = group_one_loop-group_two_loop
  if diff > 2
    group_one_padding = 20
    if diff > 4
      group_one_padding = 16
    elsif diff > 6 
      group_one_padding = 12
    elsif diff > 8 
      group_one_padding = 8
    elsif diff > 10 
      group_one_padding = 4
    else 
      group_one_padding = 2
    end
  end  
 end 
if group_two_loop > group_one_loop
  diff = group_two_loop-group_one_loop
  if diff > 2
    group_two_padding = 20
    if diff > 4
      group_two_padding = 16
    elsif diff > 6 
      group_two_padding = 12
    elsif diff > 8 
      group_two_padding = 8
    elsif diff > 10 
      group_two_padding = 4
    else 
      group_two_padding = 2
    end
  end  
 end
%>

<% if @batch.course.course_name.upcase == "NURSERY" %>
<style>
.sis-final table tr.odd td, .sis-final table tr.even td
{
    font-size: 22px !important;
    padding: 5px 12px !important;
}
.sis-final table.left-table-nursery tr.odd td, .sis-final table.left-table-nursery tr.even td
{
    padding: 16px !important;
}
.sis-final table.left-table-nursery tr.subgroup td, .sis-final table.left-table-nursery tr.subgroup td
{
    padding: 6px 12px !important;
}
.sis-final table.signature_table tr.odd td, .sis-final table.signature_table tr.even td
{
    padding: 27px !important;
}
</style>
<% else %>
<style>
.sis-final table tr.odd td, .sis-final table tr.even td
{
    padding: 26px 12px !important;
}
.sis-final table.signature_table tr.odd td, .sis-final table.signature_table tr.even td
{
    padding: 27px !important;
}
.sis-final table.left-table-nursery tr.odd td, .sis-final table.left-table-nursery tr.even td
{
    padding: 29px 12px !important;
}
.sis-final table.left-table tr.group_two td
{
    padding: <%= group_two_padding %>px 12px !important;
}
.sis-final table.left-table-nursery tr.odd td, .sis-final table.left-table-nursery tr.even td
{
    padding: <%= group_one_padding %>px 12px !important;
}
</style>
<% end %>
<style>
    .sis-final div#pdf-header-south h2
    {
       font-size: 35px !important;
    }
</style> 

