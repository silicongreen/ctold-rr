<%-# Champs21
#Copyright 2010 teamCreative Private Limited
#
#This product includes software developed at
#Project Champs21 - http://www.champs21.com/
#
#Licensed under the Apache License, Version 2.0 (the "License");
#you may not use this file except in compliance with the License.
#You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
#Unless required by applicable law or agreed to in writing,
#software distributed under the License is distributed on an
#"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
#KIND, either express or implied.  See the License for the
#specific language governing permissions and limitations
#under the License. -%>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="/stylesheets/select2.min.css">
<%= javascript_include_tag 'select2.full.min.js' %>

<%= stylesheet_link_tag 'tadded-header' %>
<%= stylesheet_link_tag 'form-bootstrap' %>
<% content_for :head do %>
  <%= javascript_include_tag "custom/tabbed-header" %>
<% end %> 

<div id="content-header">
    <%= show_header_icon %>
    <h1><%= t('fee_discounts') %></h1>
    <div class='header-sep'>|</div>
    <div class='sub-header'><%= t('finance_management') %></div>

    <div id="inner-tab-menu">
        <ul>

            <li class='themed_bg themed-dark-hover-background'><%= link_to "#{t('view_discount')}", :action=>'fee_discounts'%></li>
        </ul>

    </div>

</div>
<div id="page-yield">
    <div class="bread_crumb">
        <%= link_to t('finance_text'), :controller => "finance", :action=>"index" %> <div class = "bread-crumb-separator"> > </div>
        <%= link_to "#{t('fees_text')}", :controller => "finance", :action => "fees_index" %> <div class = "bread-crumb-separator"> > </div>
        <%= link_to "#{t('master_fees')}", :controller => "finance", :action => "master_fees" %> <div class = "bread-crumb-separator"> > </div>
        <%= t('create_discount') %>
    </div>
    <div id="flash_box">
    </div>
    <% unless flash[:notice].nil? %>
      <p class="flash-msg"> <%= flash[:notice] %> </p>
    <% end %>
    <div id="left-assign"></div>
    <div id="batch" style="padding-bottom: 30px;">
        <div id="form-errors"></div>
        <% form_for :fee_discount, :url=>{:action=>"create_student_scholarship"}  do |form|%>
          <div class="label-field-pair">
              <div class="label-container"><label for="reason"> <%= t('name') %><span class="necessary-field">*</span></label></div>
              <div class="input-container"><%= form.text_field :name, :style=>"width: 82%" %></div>
          </div>
          <div style="clear: both; height: 4px;"></div> 
          <div class="label-field-pair">
              <div class="label-container">
                  <label for="reason"><%= t('discount_on') %><span class="necessary-field">*</span>:</label>
              </div>
              <div class="input-container">
                  <%= select("fee_discount", :discount_on, @particular, {:prompt => "#{t('discount_on')}" })%>
              </div>
          </div>
          <div style="clear: both; height: 4px;"></div> 
          <div style="clear: both; height: 4px;"></div>
          <div id="discount_types_radio" class="label_field_pair">
              <div class="label-container">
                  <label class="label_for_student_gender" for="is_amount"><%= t('discount_type') %></label>
              </div>
              <div class="student_gender_value">
                  <label class="label_for_gender" for="is_amount_false"> <%= t('percentage') %></label>
                  <%= form.radio_button  :is_amount, false, :checked => "checked" %>
                  <label class="label_for_gender" for="is_amount_true"><%= t('amount') %></label>
                  <%= form.radio_button  :is_amount, true %>
              </div>
          </div>
           <div style="clear: both; height: 4px;"></div> 
          <div class="label-field-pair">
              <div class="label-container"><label for="discount">  <%= t('discount') %> <span class="necessary-field">*</span></label></div>
              <div class="input-container"><%= form.text_field :discount, :style=>"width: 82%; display: inline-block;", :class=>'precision_text' %> 
                  <span id="percent_span" style="display: none;">%</span></div>
          </div>
            <div style="clear: both; height: 4px;"></div> 
             <div style="clear: both; height: 4px;"></div> 
          <% if @batches.present? %>
            <div class="batch_select_box">
                <div class="label-field-pair">
                    <div class="label-container"><label> <%= t('select_batch') %><span class="necessary-field">*</span>:</label></div>
                    <div class="input-container">
                        <%= select("fee_discount", :batch_id, @batches,{:prompt => "#{t('select_batch')}" },
                          {:onchange => "#{remote_function(:url => {:action => "load_scholarship_students"}, :with => "'id='+value")}",
                            :before => "Element.show('loader')", :success => "Element.hide('loader')",:autocomplete => "off"})%>
                    </div>
                    <div class="loader_div">
                        <%= image_tag("loader.gif",
                          :align => "absmiddle",
                          :border => 0,
                          :id => "loader_batch",
                          :style =>"display: none;" ) %>
                    </div>
                </div>
            </div>
          <% end %>
          <div id ="students" style="margin-top: 0; margin-bottom: 0;"></div>
          <div id="submit-button">
              <%=  form.submit "â–º #{t('create_text')}", :id => "submit_button" %>
          </div>

        <% end %>
        <div style="clear: both;"></div>

        <div id="form-box" style=""></div></div>

</div>

<script>
  j(document).ready(function () {
      j(document).on("keyup", "#search_std", function () {

          var srch_val = this.value;
          j('.std_name').each(function () {
              var stdid = this.id.replace("std_", "");
              var val = j(this).html();
              if (val.toLowerCase().indexOf(srch_val.toLowerCase()) == -1)
              {
                  j('.students_box').each(function () {
                      if (this.value == stdid)
                      {
                          j(this).removeAttr('checked');
                          return;
                      }
                  });
                  j(this).parent().parent().hide();
              } else
              {
                  j('.students_box').each(function () {
                      if (this.value == stdid)
                      {
                          if (j(this).prop('checked') == false && j(this).parent().parent().css('display') != 'block')
                          {
                              if (j('#none_click').val() == 1)
                              {
                                  j(this).removeAttr('checked');
                              } else
                              {
                                  j(this).prop('checked', true);
                              }
                          }
                          return;
                      }
                  });
                  j(this).parent().parent().show();
              }
          });
      });
  });
</script>

<style>
    .select2-container .select2-selection--single
    {
        height:32px;
    }
    .mdl-data-table td, .mdl-data-table th
    {
        text-align:left;
    }
    .select2-results__options li {
        padding: 10px 4px;
        border-bottom: 1px dotted #ccc;
    }
    .select2-search--dropdown .select2-search__field {
        padding: 10px;
        border-radius: 5px;
    }
    .label_for_student_gender{font-weight: bold; margin-right: 140px;}
    #discount_types_radio{margin-top: 10px;}
    #submit-button{width: 100%; text-align: center; margin-top: 300px; }
    #submit-button input{padding: 10px;}
    .fee_category_scroll{width: 55%;}
</style>