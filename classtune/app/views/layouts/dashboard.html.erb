<%-# Champs21
#Copyright 2010 teamCreative Private Limited
#
#This product includes software developed at
#Project Champs21 - http://www.champs21.com/
#
#Licensed under the Apache License, Version 2.0 (the "License");
#you may not use this file except in compliance with the License.
#You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
#Unless required by applicable law or agreed to in writing,
#software distributed under the License is distributed on an
#"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
#KIND, either express or implied.  See the License for the
#specific language governing permissions and limitations
#under the License. -%>


<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html dir="<%= (rtl?) ? 'rtl' : 'ltr' %>">
  <head>
    <% @direction = (rtl?) ? 'rtl/' : '' %>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>ClassTune</title>
    <% unless current_school_detail.new_record? %>
      <link rel="shortcut icon" href="<%=current_school_detail.logo.url%>" type="<%=current_school_detail.logo.content_type%>" />
    <% end %>

    <%= stylesheet_link_tag(*get_stylesheets) %>
    <link rel="stylesheet" href="/stylesheets/media_query.css">
    <%= javascript_include_tag 'jquery/jquery-1.9.1.min.js' %>
    <script type="text/javascript">
      var s = jQuery.noConflict();
      s(document).ready(function() {
        set_link_active();
      });

      function set_link_active(){
        s('.top-right-link').each(function(i,el){
          if(s(el).parent().attr('href').toString() == document.location.pathname.toString())
          {
            s(el).addClass("top-right-link-active");
          }
        });
      }

    </script>

    <%= javascript_include_tag :defaults, :cache => 'cache/javascripts/all' %>
    <%= javascript_include_tag 'scripts/nicetitle', 'droplicious' %>
    <%= javascript_include_tag "fckeditor/fckeditor" %>
    <%= javascript_include_tag 'builder' %>
    <%= javascript_include_tag 'modalbox' %>

<%#= javascript_include_tag 'popup' %>

    <% Champs21Plugin.deliver_registered_hook(:application_layout_header).each do |mod| %>
      <%= render :partial=>mod.camelize.constantize.send("application_layout_header") %>
    <% end %>

    <%= calendar_date_select_includes 'red' %>
    <% CalendarDateSelect.format = :iso_date %>

    <%= javascript_include_tag "calendar_date_select/locale/#{I18n.locale}.js" unless I18n.locale==:en %>
    <%= javascript_include_tag 'champs21_plugin.js'%>
    <%= yield :head %>

    <script type="text/javascript">
      document.observe("dom:loaded", function() {
        render_generic_hook(<%= render_generic_hook %>)
      });
    </script>

<%#= javascript_include_tag 'jquery/jquery.min.js' %>
    <%= javascript_include_tag 'jquery/jquery-ui.min.js'%>
    <%= javascript_include_tag 'jquery/jquery.hotkeys.js'%>

    <script type="text/javascript">
      var j = jQuery.noConflict();
      document.observe("dom:loaded", function() {
        $$('.level-1')[0].hide();
      });
      function myfunction(){
        $$('.level-1')[0].hide();
      }
      j(document).click(function(event) {
        var myarr=["[object HTMLHeadingElement]","[object HTMLBodyElement]","[object HTMLDivElement]"]
        var contains = (myarr.indexOf(event.target.toString()) > -1);
        if(contains){
          $$('.level-1')[0].hide();
          j('#up-arrow-img').hide();
          j('#profile-link').removeClass('profile-link-active');
          j('#lower-profile-link').removeClass('top-right-link-active');
        }

      });
      j(document).ready(function() {
        
        j("#upper-menu-div").click(function(e){
          e.stopPropagation();
          j(".child-link-box").each(function() {
            j(this).css("display","none");
          });
          j(".arrow-right").css("display","none");
          j(".arrow-left").css("display","none");
        });
        j('.nav-links').click(function(){j('#lower-link-div').scrollTop(0);});
        j(document).bind("click", function() { j("#upper-menu-div").slideUp();j("#show-menu").removeClass("show-menu-active");j("#link-menu").removeClass("top-right-link-active"); });

      });

      function upper_st_switch(e) {
        e.stopPropagation();
        j('.level-1').toggle();
        j('#up-arrow-img').toggle();
        j('#profile-link').toggleClass('profile-link-active');
        j('#up-arrow-img').removeClass('arrow-img-low');
        j('#up-arrow-img').addClass('arrow-img-high');
        j('.level-1').css('position','absolute');
      }

      function lower_st_switch(e) {
        e.stopPropagation();
        j('.level-1').toggle();
        j('#up-arrow-img').toggle();
        j('#lower-profile-link').toggleClass('top-right-link-active');
        j('.level-1').css('position','fixed');
        j('#up-arrow-img').removeClass('arrow-img-high');
        j('#up-arrow-img').addClass('arrow-img-low');
      }

      function show_quick_links(){
        j.ajax({
          type: 'POST' ,
          url: "/user/show_quick_links",
          data : {

          },
          beforeSend : function() {
            if (j("#upper-menu-div").is(':hidden')){
              j(".show-menu-back").css("background","none");
              j(".show-menu-back").prepend('<img class="menu-loader" border="0" align="absmiddle" src="/images/champs21_loader.gif">')
            }
            else {
              j("#lower-link-div").css("display","none");
              j("#loader-div").css("display","block");
            }
          },
          success : function(data) {
            j("#lower-link-div").html(data);
            j(".nav-links").each(function(){j(this).removeClass("nav-links-active");j(this).removeClass("themed_text");})
            j("#quick_links").addClass("nav-links-active");
            j("#quick_links").addClass("themed_text");
            var col_no = 0;
            j( ".parent-link" ).each(function() {
              j("#col_"+col_no).append(this);
              col_no+=1;
              if(col_no==4)
                col_no=0;
            });
            j(".parent-link").hover(
            function () {
              var p = j(this);
              var main_pos = j("#lower-link-div").offset();
              var pos=p.position();
              var off=p.offset();
              var h=p.height();
              var w=p.width();
              var c_b = j(this).find(".child-link-box");
              if(c_b.length !== 0){
                var c_width = c_b.width();
                var c_height = c_b.height();
                c_b.css({ top: 8, left: w});
                c_b.css("display","block");
                c_b.click(function(e){ e.stopPropagation(); });
                var c_pos = c_b.offset();
                var main_bottom = main_pos.top + j("#lower-link-div").height();
                var child_bottom = c_pos.top + c_height;
                if(child_bottom > main_bottom){
                  j(this).attr('style', '');
                  c_b.css({ top: (10 - (child_bottom - main_bottom))});
                }
                var main_right = main_pos.left + j("#lower-link-div").width();
                var child_right = c_pos.left + c_width;
                if(child_right > main_right){
                  c_b.css({left: 0 - c_width});
<%#*j(".child_cols").addClass("right-float");%>
            }
            else
              j(".child_cols").removeClass("right-float");
          }
        },
        function () {
          j(this).find(".child-link-box").css("display","none");
        }

      );
        if (j("#upper-menu-div").is(':hidden')){
          j("#upper-menu-div").slideDown();
          j("#show-menu").addClass("show-menu-active");
          j(".show-menu-back").find('img').remove();
          j(".show-menu-back").removeAttr('style');
        }
        else {
          j("#lower-link-div").css("display","block");
          j("#loader-div").css("display","none");
        }

      }
    })
  }
  function show_all_features(th_is){
    var cur_id = j(th_is).attr("id");
    var cat_id = cur_id.replace("-link","");
    j.ajax({
      type: 'POST' ,
      url: "/user/show_all_features",
      data : {
        cat_id : cat_id
      },
      beforeSend : function() {
        j("#lower-link-div").css("display","none");
        j("#loader-div").css("display","block");
      },
      success : function(data) {
        j("#lower-link-div").html(data);
        j(".nav-links").each(function(){j(this).removeClass("nav-links-active");j(this).removeClass("themed_text");})
        j(th_is).find(".nav-links").addClass("nav-links-active");
        j(th_is).find(".nav-links").addClass("themed_text");
        var col_no = 0;
        j( ".parent-link" ).each(function() {
          j("#col_"+col_no).append(this);
          col_no+=1;
          if(col_no==4)
            col_no=0;
        });
        j(".parent-link").hover(
        function () {
          var p = j(this);
          var main_pos = j("#lower-link-div").offset();
          var pos=p.position();
          var off=p.offset();
          var h=p.height();
          var w=p.width();
          var c_b = j(this).find(".child-link-box");
          if(c_b.length !== 0){
            var c_width = c_b.width();
            var c_height = c_b.height();
            c_b.css({ top: 8, left: w});
            c_b.css("display","block");
            c_b.click(function(e){ e.stopPropagation(); });
            var c_pos = c_b.offset();
            var main_bottom = main_pos.top + j("#lower-link-div").height();
            var child_bottom = c_pos.top + c_height;
            if(child_bottom > main_bottom){
              j(this).attr('style', '');
              c_b.css({ top: (10 - (child_bottom - main_bottom))});
            }
            var main_right = main_pos.left + j("#lower-link-div").width();
            var child_right = c_pos.left + c_width;
            if(child_right > main_right){
              c_b.css({left: 0 - c_width});
<%#*j(".child_cols").addClass("right-float");%>
            }
            else
              j(".child_cols").removeClass("right-float");
          }
        },
        function () {
          j(this).find(".child-link-box").css("display","none");
        }

      );
        j("#lower-link-div").css("display","block");
        j("#loader-div").css("display","none");
      }
    })
  }
  function show_links(e){
    e.stopPropagation();
    if (j("#upper-menu-div").is(':hidden')){
      j("#header-top").append(j("#upper-menu-div"))
      j("#upper-menu-div").css('position','absolute');
      j("#upper-menu-div").css('top','35px');
      show_quick_links();
    }
    else {
      j("#upper-menu-div").slideUp();
      j("#show-menu").removeClass("show-menu-active");
    }
    //if(j("#upper-menu-div").is(":visible")){
    //show_quick_links();
    //}
  }
  function lower_show_links(e){
    e.stopPropagation();
    if (j("#upper-menu-div").is(':hidden')){
      j("#upper-menu-div").css('position','fixed');
      j("#upper-menu-div").css('top','36px');

      j("#link-menu").addClass("top-right-link-active");

      show_quick_links();
    }
    else {
      j("#upper-menu-div").slideUp();
      j("#show-menu").removeClass("show-menu-active");

      j("#link-menu").removeClass("top-right-link-active");
    }
    //if(j("#upper-menu-div").is(":visible")){
    //show_quick_links();
    //}
  }
    </script>


  </head>

  <body>
    <div id="header_bg" style="position:fixed">
      <div id = "header_bottom">
        <div class="header_content" id='header_content12' style="display:none !important;">        
          <div class="top-left-links">
            <div id="lower-show-menu"> 
              <% unless @current_user.parent? or @current_user.student?  %>
                <% unless check_free_school? and @current_user.employee? %>
                  <%= link_to "<div class='lower-menu-link' id='in-menu-link'><div class='show-menu-back'>&#9776;</div></div>","#",:onClick=>"lower_show_links(event);return false;",:id=>'link-menu' %>
                <% end %>
            <% end %>
            </div>
          </div>          
        </div>
        
        <nav class="scroll_header_nav" style="display:block !important;">
          <div class="scroll_header_content">
              
              
                    
          
             
            <%# if current_school_name.present? %>
              <%# if current_school_detail.logo.file? %>
                <%#= link_to "<div class='scroll_logo'><img src='/images/dashpallete/big_icon/diary21_logo.png'></div><div class='scoll_divider'></div><div style='    background-attachment: scroll;
    background-clip: border-box;
    background-color: #ffffff;
    background-image: url(\"#{current_school_detail.logo.url} \");
    background-origin: padding-box;
    background-size: 23%;
    background-position: 1% center;
    background-repeat: no-repeat;
    border-radius: 3px;
    color: #000000;
    float: left;
    font-size: 18px;
    font-weight: 400;
    padding: 25px 10px 25px 80px;' class='f2'>#{shorten_string(current_school_name,60)}</div>",{:controller=>"user",:action=>"dashboard"} %>
              <%# else %>
                <%#= link_to "<div class='scroll_logo'><img src='/images/dashpallete/big_icon/diary21_logo.png'></div><div class='scoll_divider'></div><div id='institution-name' class='f2'>#{shorten_string(current_school_name,60)}</div>",{:controller=>"user",:action=>"dashboard"} %>
              <%# end %>
          <%# else %>
              <%#= link_to "<div class='scroll_logo'><img src='/images/dashpallete/big_icon/diary21_logo.png'></div><div class='scoll_divider'></div><div id='institution-name' class='f2'>#{t('home')}</div>",{:controller=>"user",:action=>"dashboard"} %>
            <%# end %>
            
            <% if current_school_detail.logo.file? %>
              <%= link_to "<div class='scroll_logo'><img src='/images/dashpallete/big_icon/logo.png'></div><div class='scoll_divider'></div><img style='float:left; margin-right:5px; margin-top:13px; height:35px;' src='#{current_school_detail.logo.url}' /><div id='institution-name' class='f2'>#{shorten_string(current_school_name,60)}</div>",{:controller=>"user",:action=>"dashboard"} %>
            <% else %>   
              
              <%= link_to "<div class='scroll_logo'><img src='/images/dashpallete/big_icon/logo.png'></div><div class='scoll_divider'></div><div id='institution-name' class='f2'>#{shorten_string(current_school_name,60)}</div>",{:controller=>"user",:action=>"dashboard"} %>
             
            <% end %>  


            <div id="lower-show-menu">
              <% unless @current_user.parent? or @current_user.student?  %>
                <% unless check_free_school? and @current_user.employee? %>
                  <%= link_to "<div class='lower-menu-link' id='in-menu-link'><div class='show-menu-back'>&#9776;</div></div>","#",:onClick=>"lower_show_links(event);return false;",:id=>'link-menu' %>
                <% end %>
              <% end %>
            </div>
            <% if current_school_name.present? %>
              <%= link_to "<div id='institution-name1'>#{shorten_string(current_school_name,60)}</div>",{:controller=>"user",:action=>"dashboard"} %>
            <% else %>
              <%= link_to "<div id='institution-name1'>#{t('home')}</div>",{:controller=>"user",:action=>"dashboard"} %>
            <% end %>
            <% show_links = false %>  
            <% if @current_user.admin? or @current_user.student? or @current_user.parent? or @current_user.employee? %>  
              <% show_links = true %>  
            <% end %>  
            <% if show_links %>    
            <div class="right-links" id="top-right-links">
              <%  if !check_free_school? %>
                <% reminder_count = @current_user.check_reminders %>
                <% all_new_reminders = @current_user.all_new_reminders_user %>
                <% unless reminder_count == 0 %>
                <div class="top-right-main">
                    <%#*<div id='msg-count'>#{reminder_count}</div>%>
                  <%= link_to "<div class='top-right-link'><div id='message-link-img'><div id='msg-count'>#{reminder_count}</div></div></div>", :controller => "/reminder", :action => "index" %>
                  <div class="nav-description" style="max-height:750px; overflow:auto;">
                    <% all_new_reminders.each do |ur| %>
                      <p><%= link_to "#{ur.body} - Published : #{ur.created_at.strftime("%d-%m-%Y")}",  :controller=>"reminder", :action=>"view_reminder",:id2=>ur.id %></p>
                    <% end %>
                  </div>
                </div>  
                <% else %>
                  <%= link_to "<div class='top-right-link'><div id='message-link-img'></div></div>", :controller => "/reminder", :action => "index" %>
                <% end %>
              <% end %>   
                
              <%siblings_list= @current_user.guardian_entry.guardian_student if @current_user.parent? %>
              <%#  siblings_list= @current_user.guardian_entry.current_ward.siblings.select{|p| p.immediate_contact_id=@current_user.id} if @current_user.parent? %>
              <%=link_to "<div class='top-right-link' id='lower-profile-link'><div id='profile-link-img'></div></div>", "#",:onClick=>"lower_st_switch(event);return false;"  %>
              <div class="leg" style="width:40px;clear:both;">
                <div id="profile-menu">
                  <li class="a">
                    <div id="switch-student">
                      <ul class="level-1" style="display:none;position: absolute !important;">
                        <li><div class="ns">
                            <div class="not-selected-list" style="margin-top:5px !important;">
                              <%=link_to @main_user_data.full_name,{ :controller => '/user', :action => 'profile', :id => @main_user_data.username }%></div><br />
                            <div class="bottom-line"></div>
                          </div>
                        </li>
                        <%if siblings_list.present?%>
                          <li style="color:#808080;font-size:11px;padding-left:23px;padding-top:5px;padding-bottom:5px"><%=t('switch_student')%> :</li>
                        <% end %>
                        <li><div class="ns" >
                            <%if siblings_list.present?%>
                              <%@sibling_student=@current_user.guardian_entry.current_ward%>
                              <%@sibling_students=siblings_list%>
                              <div class="selected_student"><%=link_to "#{'&#10003;'}#{shorten_string(@sibling_student.full_name,15)}",:controller=>'user',:action=>'dashboard',:id=>@sibling_student.id%></div><br/>
                              <%(@sibling_students).each do|s|%>
                                <% if s.id!=@sibling_student.id %>
                                <div class="not-selected-list" >
                                  <%=link_to shorten_string(s.full_name,15),:controller=>'user',:action=>'dashboard',:id=>s.id%></div><br />
                                <% end %>  
                              <%end%>

                              <div class="bottom-line"></div>
                            <% end %>
                            <div class="not-selected-list" style="margin-bottom:5px !important;" ><%= link_to t("log_out"), { :controller => '/user', :action => 'logout' } %></div>
                          </div></li>
                      </ul></div>
                  </li></div></div>
  <%#= link_to "<div class='top-right-link'><div id='logout-link-img'></div></div>", :controller => '/user', :action => 'logout' %>
            </div>
            <%  if !check_free_school? %>
              <div id="outer-autosuggest-menu">
                <%= render :partial => "layouts/autosuggest_menu" %>
              </div>
            <% end %>  
            <% else %>  
              <div class="right-links" id="top-right-links">
                <%siblings_list= @current_user.guardian_entry.guardian_student if @current_user.parent? %>
                <%#  siblings_list= @current_user.guardian_entry.current_ward.siblings.select{|p| p.immediate_contact_id=@current_user.id} if @current_user.parent? %>
                <%=link_to "<div class='top-right-link' id='lower-profile-link'><div id='profile-link-img'></div></div>", "#",:onClick=>"lower_st_switch(event);return false;"  %>
                <div class="leg" style="width:40px;clear:both;">
                  <div id="profile-menu">
                    <li class="a">
                      <div id="switch-student">
                        <ul class="level-1" style="display:none;position: absolute !important;">
                          <li><div class="ns">
                              <div class="not-selected-list" style="margin-top:5px !important;">
                                <%=link_to @main_user_data.full_name,{ :controller => '/user', :action => 'profile', :id => @main_user_data.username }%></div><br />
                              <div class="bottom-line"></div>
                            </div>
                          </li>
                          <%if siblings_list.present?%>
                            <li style="color:#808080;font-size:11px;padding-left:23px;padding-top:5px;padding-bottom:5px"><%=t('switch_student')%> :</li>
                          <% end %>
                          <li><div class="ns" >
                              <%if siblings_list.present?%>
                                <%@sibling_student=@current_user.guardian_entry.current_ward%>
                                <%@sibling_students=siblings_list%>
                                <div class="selected_student"><%=link_to "#{'&#10003;'}#{shorten_string(@sibling_student.full_name,15)}",:controller=>'user',:action=>'dashboard',:id=>@sibling_student.id%></div><br/>
                                <%(@sibling_students).each do|s|%>
                                  <% if s.id!=@sibling_student.id %>
                                  <div class="not-selected-list" >
                                    <%=link_to shorten_string(s.full_name,15),:controller=>'user',:action=>'dashboard',:id=>s.id%></div><br />
                                  <% end %>  
                                <%end%>

                                <div class="bottom-line"></div>
                              <% end %>
                              <div class="not-selected-list" style="margin-bottom:5px !important;" ><%= link_to t("log_out"), { :controller => '/user', :action => 'logout' } %></div>
                            </div></li>
                        </ul></div>
                    </li></div></div>
    <%#= link_to "<div class='top-right-link'><div id='logout-link-img'></div></div>", :controller => '/user', :action => 'logout' %>
              </div>
            <% end %>  
          </div>
        </nav>
        
      </div>
      
    </div>

    <div id="content_wrapper" >
      <div id="content"> <%= yield %> </div>

      <div class="extender"></div>
    </div>

    <div id="footer">
      <div id="footer_logo">
        <div id="powered_by">
          <%= t('powered_by') %> <a href=<%= "#{Champs21Setting.company_details[:company_url]}" %> target="_blank", class="themed_text"><%= Champs21Setting.company_details[:company_name] %></a>
        </div>
      </div>
    </div>
  </body>
</html>

<style>
    #profile-menu {
        margin-top: 20px;
    }
    #profile-menu li ul.level-1 {
        -webkit-box-shadow: 2px 2px 5px 0px rgba(0,0,0,0.75);
        -moz-box-shadow: 2px 2px 5px 0px rgba(0,0,0,0.75);
        box-shadow: 2px 2px 5px 0px rgba(0,0,0,0.75);
    }
    a {
      color:black;
    }
    a:hover {
      text-decoration: underline;
    }
    #lower-show-menu, #outer-autosuggest-menu, #message-link-img {
        display: none;
    }
    body > #content_wrapper {
        margin-top: 100px;
    }
</style>