<div id="content-header">
<%= show_header_icon %>
  <h1><%= t('student_text') %></h1>
<div class='header-sep'>|</div>
<div class='sub-header'><%= t('fee_status') %></div>

<div id="inner-tab-menu">
  <ul>
    <li class='themed_bg themed-dark-hover-background'><%= link_to "#{t('fees_text')}", :controller => 'student', :action => 'fees', :id => @student.id %></li>
    <li class='themed_bg themed-dark-hover-background'><%= link_to "#{t('student_profile')}", :controller => 'student', :action => 'profile', :id => @student.id %></li>
  </ul>
</div>
</div>
<div id="page-yield">

  <% unless flash[:notice].nil? %> <p class="flash-msg"> <%= flash[:notice] %> </p> <% end %>
  <div id="student_profile_heading1">
    <div id="student_main_info1">
      <span class="name"><b> <%= @student.full_name %> </b> </span>
      <span class="course"><%= t('course_and_batch') %>: <%= @student.batch.course_name %> </span>
      <span class="adm"><%= t('adm_no') %>: <%= @student.admission_no %> </span>
    </div>
    <div class="extender"> </div>
  </div>
  <% if @paid_fees.nil? %>
    <table id="listing" align="center" width="100%" cellpadding="1" cellspacing="1">
      <tr class="tr-head">
        <td><%= t('particulars') %> </td>
        <td><%= t('amount') %> (<%= currency %>  )</td>
      </tr>
      <tr class="tr-blank"></tr>
      <tr class="tr-even">
        <td class="col-2"><%= t('fare') %></td>
        <td class="col-6"><%=precision_label @fee.bus_fare.to_f%></td>
      </tr>
      <tr class="tr-blank"></tr>
      <tr class="tr-blank"></tr>
      <tr class="tr-odd">
        <td class="col-8"><%= t('amount_to_be_paid') %></td>
        <% total_fees = @student.transport_fee_balance(params[:id2]) %>
        <td class="col-6"><%= precision_label total_fees %></td>
      </tr>
      <% if (Champs21Plugin.can_access_plugin?("champs21_pay") and PaymentConfiguration.config_value("enabled_fees").present? and PaymentConfiguration.config_value("enabled_fees").include? "Transport Fee") %>
        <% unless (@current_user.admin? or @current_user.employee?) %>
          <% if total_fees == 0 %>
            <tr>
              <td colspan="5">
                <%= link_to "► #{t('print_receipt')}",
                  {:controller => "transport_fee", :action => "transport_fee_receipt_pdf", :id => @fee.finance_transaction(:id)},:target => '_blank', :class=> 'user_button' %>
              </td>
            </tr>
          <% else %>
            <tr>
              <td colspan="3">
                <% if @active_gateway == "Paypal" %>
                  <%= paypal_pay_button(@certificate,@merchant_id,"TRANSPORT FEE #{@fee.transport_fee_collection.name}",total_fees,"http://#{request.host_with_port}/transport_fee/student_profile_fee_details/#{params[:id]}/#{params[:id2]}?create_transaction=1",@paid_fees,"float: right;margin: 18px 0 0;") %>
                <% elsif @active_gateway == "Authorize.net" %>
                  <%= authorize_net_pay_button(@merchant_id,@certificate,total_fees,"TRANSPORT FEE (#{@student.full_name}-#{@student.admission_no}-#{@fee.transport_fee_collection.name})","http://#{request.host_with_port}/transport_fee/student_profile_fee_details/#{params[:id]}/#{params[:id2]}?create_transaction=1&only_path=false",@paid_fees,"float: right;margin: 18px 0 0;") %>
                <% end %>
              </td>
            </tr>
          <% end %>
        <% end %>
      <% end %>
    </table>
  <% else %>
    <table id="listing" align="center" width="100%" cellpadding="1" cellspacing="1">
      <tr class="tr-head">
        <td><%= t('particulars') %></td>
        <td><%= t('payment_date') %></td>
        <td><%= t('payment_mode') %></td>
        <td><%= t('payment_notes') %></td>
        <td><%= t('amount') %> (<%= currency %>  )</td>
      </tr>
      <tr class="tr-blank"></tr>
      <tr class="tr-even">
        <td class="col-1"><%= t('fare') %></td>
        <td class="col-3"><%= @paid_fees.transaction_date %></td>
        <td class="col-3"><%= @paid_fees.payment_mode %></td>
        <td class="col-2"><%= @paid_fees.payment_note %></td>
        <td class="col-3"><%= precision_label @paid_fees.amount.to_f %></td>
      </tr>
      <tr class="tr-blank"></tr>
      <tr class="tr-blank"></tr>
      <tr class="tr-odd">
        <td class="col-8" colspan="4"><%= t('amount_to_be_paid') %></td>
        <% total_fees = @student.transport_fee_balance(params[:id2]) %>
        <td class="col-3"><%= precision_label total_fees %></td>
      </tr>
      <% if (Champs21Plugin.can_access_plugin?("champs21_pay") and PaymentConfiguration.config_value("enabled_fees").present? and PaymentConfiguration.config_value("enabled_fees").include? "Transport Fee") %>
        <% unless (@current_user.admin? or @current_user.employee?) %>
          <% if total_fees == 0 %>
            <tr>
              <td colspan="5">
                <%= link_to "► #{t('print_receipt')}",
                  {:controller => "transport_fee", :action => "transport_fee_receipt_pdf", :id => @fee.finance_transaction.try(:id)},:target => '_blank', :class=> 'user_button' %>
              </td>
            </tr>
          <% end %>
        <% end %>
      <% end %>
    </table>
  <% end %>
</div>
