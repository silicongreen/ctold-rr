<%-# Champs21
#Copyright 2010 teamCreative Private Limited
#
#This product includes software developed at
#Project Champs21 - http://www.champs21.com/
#
#Licensed under the Apache License, Version 2.0 (the "License");
#you may not use this file except in compliance with the License.
#You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
#Unless required by applicable law or agreed to in writing,
#software distributed under the License is distributed on an
#"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
#KIND, either express or implied.  See the License for the
#specific language governing permissions and limitations
#under the License. -%>

<div style="width: 40%; float: left;">
  <span style="padding: 8px 15px 5px 13px; font-weight: bold; display: block; font-size: 14px; font-family: verdana; text-align: left;">Student List <span style="font-weight: normal;">(Only Unpaid Student):</span>  </span>
</div>
<% unless @fine_configurations.blank? %>
<div style="width: 55%; float: right; text-align: right;">
  <div class="label-field-pair" style="padding-top: 10px; padding-bottom: 10px; float: right; width: 50%; margin: 0 0; ">
    <div class="input-container" style="width: 100%; position: relative;">
        <input type="hidden" name="option_filter" id="option_filter" value="<%= @opt %>" />
        <% if @filter_by_course.blank? %>
          <% @filter_by_course = 0 %>
        <% end %>
        <% if @b_id.blank? %>
          <% @b_id = 0 %>
        <% end %>
        <% if @section_id.blank? %>
          <% @section_id = 0 %>
        <% end %>
        <% if @course_name.blank? %>
          <% @course_name = 0 %>
        <% end %>
        <input autocomplete="off" type="text" name="student_admission_no_permission" id="student_admission_no_permission" placeholder="Student Admission No" style="width: 80%;" date-opt="<%= @opt %>" data-filter_by_course="<%= @filter_by_course %>" data-date="<%= @d_id %>" data-batch_id="<%= @b_id %>" data-course_name="<%= @course_name %>" data-section_id="<%= @section_id %>" value="<%= @student_admission_no %>" />
        <div class="group-checked filter-single-payment" date-opt="<%= @opt %>" data-filter_by_course="<%= @filter_by_course %>" data-date="<%= @d_id %>" data-batch_id="<%= @b_id %>" data-course_name="<%= @course_name %>" data-section_id="<%= @section_id %>">
            <i class="fa fa-check-circle filter-single-payment" aria-hidden="true" date-opt="<%= @opt %>" data-filter_by_course="<%= @filter_by_course %>" data-date="<%= @d_id %>" data-batch_id="<%= @b_id %>" data-course_name="<%= @course_name %>" data-section_id="<%= @section_id %>"></i>
        </div>
    </div>
  </div>
</div>
<% end %>
<div style="clear: both; height: 1px;"></div>
<% if @fine_configurations.blank? %>
  <p class="flash-msg"><%= "Fine Permission Enabled - No Students found" %></p>
<% else %>
  <table class="table table-striped table-bordered" id="example" cellspacing="0" cellpadding="0" border="0" style="width: 100%; margin-top: 10px;">
    <thead><!-- class="thead-inverse" -->
      <tr>
        <th><%= t('sl_no') %></th>
        <th><%= t('admission_no') %></th>
        <th><%= "Student Info" %></th>
        <th><%= "" %></th>
      </tr>
    </thead>
    <tbody>
    <% @fine_configurations.each_with_index do |s,i| %>
        <% fees = s.finance_fees.select{|fee| fee.balance > 0 and @dates_id.include?(fee.fee_collection_id)} %>
        <% unless fees.blank? %>
          <% fees.each do |fee| %>
          <tr class="tr-odd">
              <td style="text-align: center; vertical-align: middle;"><%= i + 1 %></td>
              <td style="text-align: center; vertical-align: middle;"><%= s.admission_no %></td>
              <td style="text-align: left;">
                  <a href="/student/fees/<%= s.id %>" target="_blank" style="color: #444; line-height: 23px; font-size: 16px; text-decoration: none;">
                      <div style="width: 100px; display: inline-block; float: left;">
                        <% if s.photo.file? %>
                        <% @profile_image = s.photo.url %>

                        <% unless @profile_image.index("RackMultipart").nil? %>
                          <% if s.photo.exists? %>
                            <% unless @profile_image.index("?").nil?  %>
                              <% @profile_image.gsub! '?', '.?' %>
                            <% else %>
                              <% @profile_image = @profile_image+"." %>
                            <% end %>  
                          <% else %>
                            <% @profile_image = "master_student/profile/default_student.png" %>
                          <% end %>
                        <% end %>

                      <% else %>
                        <% @profile_image = "master_student/profile/default_student.png" %>
                      <% end %>
                      <%= image_tag "#{@profile_image}", :width=>"80" %>
                    </div>
                    <div style="display: inline-block; float: left; padding-left: 10px;">
                      <%= s.full_name unless s.full_name.nil? %><br />
                      <small>Roll No: <%= s.class_roll_no unless s.class_roll_no.nil? %></small><br />
                      <small><%= s.batch.full_name %></small><br />
                    </div>
                  </a>
              </td>
              <td style="text-align: center; vertical-align: middle;">
                <% fine_enabled = true %>
                <% student_fee_configuration = StudentFeeConfiguration.find(:first, :conditions => "student_id = #{s.id} and date_id = #{fee.fee_collection_id} and config_key = 'fine_payment_student'") %>
                <% unless student_fee_configuration.blank? %>
                  <% if student_fee_configuration.config_value.to_i == 1 %>
                    <% fine_enabled = true %>
                  <% else %>
                    <% fine_enabled = false %>
                  <% end %>
                <% end %>
                <% if fine_enabled %>
                <i id="fine_payment_student" name="fine_payment_student" class="fa fa-check-square-o fine_payment_student" style="font-size: 20px; " data-date_id="<%= fee.fee_collection_id %>" data-student-id="<%= s.id %>"></i>
                <% else %>
                <i id="fine_payment_student" name="fine_payment_student" class="fa fa-square-o fine_payment_student" style="font-size: 20px; " data-date_id="<%= fee.fee_collection_id %>" data-student-id="<%= s.id %>"></i>
                <% end %>  
              </td>
          </tr>
          <% end %>
        <% end %>
    <% end %>
    </tbody>
  </table>
  <% if @opt == 1 %>
  <div class="pagination_div" style="margin-top: 50px;">
      <div class="div1">
          <%= will_paginate @fine_configurations, :previous_label=>"<", :next_label=>">", :renderer => 'RemoteLinkRenderer' ,:remote => { :loading =>  "$('loader_paginate').show();",:complete =>"$('loader_paginate').hide();"  }, :params => {:controller=>:finance,:action => "fine_configuration_students", :opt => @opt, :filter_by_course => @filter_by_course, :date => @date.id} %>
      </div>
      <div class="div2"><%= image_tag("loader.gif",
        :align => "absmiddle",
        :border => 0,
        :id => "loader_paginate",
        :style =>"display: none;" ) %></div>
  </div>
  
  <% elsif @opt == 2 %>
  <div class="pagination_div" style="margin-top: 50px;">
      <div class="div1">
          <%= will_paginate @fine_configurations, :previous_label=>"<", :next_label=>">", :renderer => 'RemoteLinkRenderer' ,:remote => { :loading =>  "$('loader_paginate').show();",:complete =>"$('loader_paginate').hide();"  }, :params => {:controller=>:finance,:action => "fine_configuration_students", :opt => @opt, :section_id => @section_id, :course_name => @course_name, :batch_id => @b_id, :date => @d_id} %>
      </div>
      <div class="div2"><%= image_tag("loader.gif",
        :align => "absmiddle",
        :border => 0,
        :id => "loader_paginate",
        :style =>"display: none;" ) %></div>
  </div>
  <% else %>
  <div class="pagination_div" style="margin-top: 50px;">
      <div class="div1">
          <%= will_paginate @fine_configurations, :previous_label=>"<", :next_label=>">", :renderer => 'RemoteLinkRenderer' ,:remote => { :loading =>  "$('loader_paginate').show();",:complete =>"$('loader_paginate').hide();"  }, :params => {:controller=>:finance,:action => "fine_configuration_students", :batch_id => @b_id, :date => @d_id} %>
      </div>
      <div class="div2"><%= image_tag("loader.gif",
        :align => "absmiddle",
        :border => 0,
        :id => "loader_paginate",
        :style =>"display: none;" ) %></div>
  </div>
  <% end %>
<% end %>
<style>
    .user_button {margin: 0;}
    .pagination {
        margin-top: -35px;
    }
    .div2{
      float: right;
      margin-top: -35px;
      margin-right: 5px;
    }
</style>
<style>
  .label-field-pair .label-container {
    width: 37%;
    padding-top: 4px;
    float: left;
  }
  .select2-container {
    width: 92% !important;
  }
  .course_area .select2-container {
    width: 100% !important;
  }
  .label-field-pair input{
    margin: 0;
    width: 92%;
  }
  .group-checked{
    position: absolute;
    right: 7px;
    background: #eee;
    top: 0;
    height: 26px;
    width: 50px;
    border-bottom-right-radius: 4px;
    border-top-right-radius: 4px;
    border: 1px solid #ccc;
    border-left: 1px solid #aaa;
    text-align: center;
    vertical-align: middle;
    display: table-cell;
    vertical-align: middle;
    padding-top: 6px;
    cursor: pointer;
  }
</style>
