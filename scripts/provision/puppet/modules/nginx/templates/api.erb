server {

    listen <%= listen %> ;

    server_name  <% real_server_name.each do |s_n| -%><%= s_n %> <% end -%>;

    access_log  <%= real_access_log %>;
    error_log   <%= real_error_log %>;

    root <%= root %>;

    <% if listen == '443' %>
        ssl  on;
        ssl_certificate  <%= real_ssl_certificate %>;
        ssl_certificate_key  <%= real_ssl_certificate_key %>;
        ssl_session_timeout  <%= ssl_session_timeout %>;

        ssl_protocols  SSLv2 SSLv3 TLSv1;
        ssl_ciphers  ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;
        ssl_prefer_server_ciphers   on;
    <% end -%>

    index index.php;
	
     location /api {
           rewrite ^/(.*)$ /index.php?r=$1;

    }

    location /site {
           rewrite ^/(.*)$ /index.php?r=$1;

    }


    #location ~ .*\.(php)$ {
    #    if (!-e $document_root$document_uri){return 404;}
    # 
    #    fastcgi_pass unix:/var/run/php5-fpm.sock;
    #    fastcgi_index index.php;
    #    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    #    fastcgi_param APPLICATION_ENV development;
    #    include /etc/nginx/includes/fastcgi_params.inc;
    #    fastcgi_cache off;
    #}

    
    location / {
        #rewrite ^/(.*)$ /index.php?r=$1;
        #if (!-e $document_root$document_uri){return 404;}

        fastcgi_pass unix:/var/run/php5-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME /vagrant/src/api$fastcgi_script_name;
        fastcgi_param APPLICATION_ENV development;
        include /etc/nginx/includes/fastcgi_params.inc;
        fastcgi_cache off;
    }


}


