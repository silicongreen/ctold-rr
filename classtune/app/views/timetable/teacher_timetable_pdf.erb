<%-# Champs21
#Copyright 2010 teamCreative Private Limited
#
#This product includes software developed at
#Project Champs21 - http://www.champs21.com/
#
#Licensed under the Apache License, Version 2.0 (the "License");
#you may not use this file except in compliance with the License.
#You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
#Unless required by applicable law or agreed to in writing,
#software distributed under the License is distributed on an
#"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
#KIND, either express or implied.  See the License for the
#specific language governing permissions and limitations
#under the License. -%>

<div id="page-yield">

  <div class="hor_line"></div>
  <h2><%= t('timetable_text') %></h2>
  <div class="hor_line"></div>


  <div class="extender"> </div>
  <div class="report">

    <div id ="main_info">
      <h3> <%= @employee.full_name %></h3>
    </div>
    <div id="pdf-info">
      <table id="pdf-table" width="100%" cellspacing="0">
        <tr class="table-header">
          <td class="col-pdf"><%= t('day') %></td>
          <% @all_classtimings.each do |ct| -%>
            <td class="col-pdf">
                <%  if Configuration.find_by_config_key('RountineViewPeriodNameNoTiming').present? and Configuration.find_by_config_key('RountineViewPeriodNameNoTiming').config_value=="1" %>
                  <%= ct.name %>  
                <% else %>
                  <%= "#{ct.start_time.strftime("%I:%M%p")} - #{ct.end_time.strftime("%I:%M%p")}" -%>
                <% end %>
             
            </td>
          <% end -%>
        </tr>
        <% @all_weekdays.each do |weekday| -%>
          <% c =cycle('even','odd ') %>
          <tr class="<%= "#{c}" %>">
            <td class="col-pdf"><%= WeekdaySet.weekday_name(weekday).upcase -%></td>
            <% @all_classtimings.each do |ct| -%>
            <td class="col-pdf">
                <div class="batch">
                  <% unless @timetable_entries[weekday][ct.id].blank? %>
                    <% if @timetable_entries[weekday][ct.id].size > 1 %>
                      <div class="entries_wrapper">
                        <div class="entries">
                          <% @timetable_entries[weekday][ct.id].each_pair do |k, tte| %>
                            <div class="sub_name">
                              <% if tte.subject.elective_group.nil? %>
                                <%= formatted_timetable_cell(tte)  -%>
                              <% else %>
                                <%= @electives[tte.subject.elective_group_id].first.code %>
                              <% end %>
                            </div>
                            <div class="batch_name themed_text batch_code no_padding">
                              <%= timetable_batch (tte)  -%>
                            </div>
                          <% end %>
                        </div>
                      </div>
                      <% tte = @timetable_entries[weekday][ct.id].first %>
                      <% unless tte.blank? %>
                        <div class="sub_name">
                          <% if tte.last.subject.elective_group.nil? %>
                            <%= formatted_timetable_cell(tte.last)  -%>
                          <% else %>
                            <%= @electives[tte.last.subject.elective_group_id].first.code %>
                          <% end %>
                        </div>
                        <div class="batch_name1 themed_text batch_code no_padding">
                          <%= timetable_batch (tte.last)  -%>
                        </div>
                        <a class="themed_text add_sym">+</a>
                      <% end %>
                    <% else %>
                      <% tte = @timetable_entries[weekday][ct.id].first %>
                      <% unless tte.blank? %>
                        <% if tte.last.subject.elective_group.nil? %>
                          <div class="sub_name">
                            <%= formatted_timetable_cell(tte.last)  -%>
                          </div>
                        <% else %>
                          <div class="sub_name">
                            <%= @electives[tte.last.subject.elective_group_id].first.code %>
                          </div>
                        <% end %>
                        <div class="batch_name themed_text batch_code no_padding">
                          <%= timetable_batch (tte.last)  -%>
                        </div>
                      <% end %>
                    <% end %>
                  <% end -%>
                  <%  if Configuration.find_by_config_key('RountineViewPeriodNameNoTiming').present? and Configuration.find_by_config_key('RountineViewPeriodNameNoTiming').config_value=="1" %>
                  <% elsif Configuration.find_by_config_key('ViewSmallRoutine').present? and Configuration.find_by_config_key('ViewSmallRoutine').config_value=="1" %>
                    <% if !@main_time_table_id.blank? and !@main_time_table_id[weekday].blank? and !@main_time_table_id[weekday][ct.id].blank? %>
                    <% main_class_timming = @main_time_table_id[weekday][ct.id] %>

                    <% main_timing = ClassTiming.find_by_id(main_class_timming) %>
                    <div class="sub_name">
                       <%=main_timing.start_time.strftime("%I:%M%p")  unless main_timing.start_time.nil? %> - <%= main_timing.end_time.strftime("%I:%M%p")  unless main_timing.end_time.nil? %>
                    </div>
                    <% end %>
                  <% end %>
                </div>
              </td>
            <% end %>    

            
          </tr>
        <% end %>
      </table>
    </div>

  </div>
</div>
