<% unless @report_data.blank?  or  @report_data['report'].blank? %>
  <div id="pdf-header-south" class="sfx-header">
    <h2 align="center">Navy Anchorage School And College Dhaka</h2>
  </div> 
  <div id="page-yield"  class="available_sections1 sjis-new sfx">
      <h2 align="center"><%= @connect_exam_obj.name %></h2>
      <table id="pdf-table" class="margin-top-bottom-20" width="100%" cellspacing="0">
          <tr class="even">
              <td>Student's Name : <b><%= @student.full_name %></b></td>
              <td>Class : <b><%= @batch.course.course_name %></b></td>
              <td>Section : <b><%= @batch.course.section_name %></b></td>
              <td>Roll : <b><%= @student.class_roll_no %></b></td>
          </tr>
          <tr class="even">
              <% month_number =@connect_exam_obj.published_date.blank? ? @connect_exam_obj.created_at.strftime("%-m"):@connect_exam_obj.published_date.strftime("%-m") %>
              <td colspan="2">Academic Year : 
                  <b>
                    <% if month_number.to_i>7 %>
                      <%= @connect_exam_obj.published_date.blank? ? @connect_exam_obj.created_at.strftime("%Y"):@connect_exam_obj.published_date.strftime("%Y") %>-<%= @connect_exam_obj.published_date.blank? ? @connect_exam_obj.created_at.strftime("%Y").to_i+1:@connect_exam_obj.published_date.strftime("%Y").to_i+1 %>
                    <% else %>
                      <%= @connect_exam_obj.published_date.blank? ? @connect_exam_obj.created_at.strftime("%Y").to_i-1:@connect_exam_obj.published_date.strftime("%Y").to_i-1 %>-<%= @connect_exam_obj.published_date.blank? ? @connect_exam_obj.created_at.strftime("%Y"):@connect_exam_obj.published_date.strftime("%Y") %>
                    <% end %>
                  </b>  
              </td>
              <td colspan="2">Class Teacher's Name : 
                <% unless @assigned_employee.blank? %>
                  <% @assigned_employee.each do |emp| %>
                      <% emp_full_name = emp.first_name.to_s+" "+emp.last_name.to_s  %>
                      <b><%= emp.first_name %>&nbsp;<%= emp.last_name %></b>
                    <% break %>
                  <% end %>
                <% end %>
              </td>
                  
                  
          </tr>
      </table>
      <div class ="current_batch" style="margin-left:0px;">
          <div id="grouped_exam_report">

              
              
              <table id="pdf-table" width="99.8%" cellspacing="0">
                  <% c = 'even'  %>
                  <% colspan2 = 1 %>
                  <% has_mcq = false %>
                  <% has_ct = false %>
                  <% ct_highest = 20 %>
                  <% ct_lowest = 10 %>
                  <% unless @report_data['report']['exams'].blank? %>
                    <% @report_data['report']['exams'].each do |report| %>
                      <%  if report['exam_category'] == '4' %>
                        <% has_mcq = true %>
                        <% colspan2 = colspan2+1 %>
                      <% end %>
                      <%  if report['exam_category'] == '1' %>
                        <% has_ct = true %>
                        <% colspan2 = colspan2+1 %>
                      <% end %>
                    <% end %>
                  <% end %>
                  <% if has_mcq %>
                    <% colspan2 = colspan2+1 %>
                  <% end %>
                  <% if has_ct %>
                    <% colspan2 = colspan2+1 %>
                  <% end %>
                  <% colspan1 = colspan2+1 %>
                  <tr class="table-header">
                      <td colspan='<%= colspan1 %>'><b>Academic Performance (January - March)</b></td>
                  </tr>
                  <tr class="table-header">
                      <td class="col-pdf no-warp" rowspan="2"><b><%= "Subject" %></b></td>
                      <td class="col-pdf no-warp" colspan='<%= colspan2 %>'><b><%= "Marks" %></b></td>
                  </tr>
                  <tr class="table-header">
                    <% if has_mcq %>
                      <% unless @report_data['report']['exams'].blank? %>
                        <% @report_data['report']['exams'].each do |report| %>
                           <%  if report['exam_category'] == '4' %>
                              <td class="col-pdf"><%= report['exam_name'] %></td>
                           <% end %>
                        <% end %>
                      <% end %>   
                      <td class="col-pdf">Conv. to 5</td> 
                    <% end %> 
                    <% if has_ct %>
                      <% unless @report_data['report']['exams'].blank? %>
                        <% @report_data['report']['exams'].each do |report| %>
                           <%  if report['exam_category'] == '1' %>
                              <td class="col-pdf"><%= report['exam_name'] %></td>
                              <% if @exam_marks[report['exam_id'].to_s].to_i > ct_highest  %>
                                <% ct_highest = @exam_marks[report['exam_id'].to_s].to_i %>
                              <% end %>
                              <% if @exam_marks[report['exam_id'].to_s].to_i < ct_lowest  %>
                                <% ct_lowest = @exam_marks[report['exam_id'].to_s].to_i %>
                              <% end %>
                           <% end %>
                        <% end %>
                      <% end %>   
                      <td class="col-pdf">Conv. CT (<%= ct_lowest %>/<%= ct_highest %>)</td> 
                    <% end %>
                  </tr>
                  <% unless @report_data['report']['subjects'].blank? %> 
                    <% @report_data['report']['subjects'].each do |subjects| %>
                      <% subjectdata = Subject.find(subjects['id'].to_i) %>
                      <%= render  :partial=>"/connect_exam/check_student_subject", :locals=>{:student_id=>@student.id.to_s,:subject_id=>subjects['id'].to_s,:elective_group_id=>subjectdata.elective_group_id.to_i} %>
                      <% if @has_exam_student == false %>
                         <% next %>
                      <% end %>
                      <% if subjects['no_exams_sjws'].to_i == 1  %>
                        <% next %>
                      <% end %>
                      <% has_exam = false %>
                      <% unless @report_data['report']['exams'].blank? %>
                        <% @report_data['report']['exams'].each do |report| %>
                          <% if !report['result'].blank? and !report['result'][report['exam_id']].blank? and !report['result'][report['exam_id']][subjects['id']].blank?  and !report['result'][report['exam_id']][subjects['id']]['marks_obtained'].blank? %>
                            <% if report['result'][report['exam_id']][subjects['id']]['marks_obtained'] != "AB" %>
                              <% has_exam = true %>
                              <% break %>
                            <% end %>
                          <% end %>
                        <% end %>
                      <% end %>
                      <% if has_exam == false %>
                         <% next %>
                      <% end %>
                      <tr class="<%= cycle(c,(["odd","even"]-[c]).first) %>">
                          <td class="col-pdf  no-warp align-left-baf"><%= subjects['name'] %></td>
                          <% mcq_mark = 0 %>
                          <% mcq_full_mark = 0 %>
                          <% total_mark = 0 %>
                          <% ct_mark = 0 %>
                          <% mcq_mark_converted = 0 %>
                          <% unless @report_data['report']['exams'].blank? %>
                            <% @report_data['report']['exams'].each do |report| %>
                               <%  if report['exam_category'] == '4' %>
                                  <% if !report['result'].blank? and !report['result'][report['exam_id']].blank? and !report['result'][report['exam_id']][subjects['id']].blank?  and !report['result'][report['exam_id']][subjects['id']]['marks_obtained'].blank? %>
                                    <td class="col-pdf"><%= report['result'][report['exam_id']][subjects['id']]['marks_obtained'] %></td>
                                    <% mcq_mark = mcq_mark+report['result'][report['exam_id']][subjects['id']]['marks_obtained'].to_f %>
                                  <% end %>
                                  <% if !report['result'].blank? and !report['result'][report['exam_id']].blank? and !report['result'][report['exam_id']][subjects['id']].blank?  and !report['result'][report['exam_id']][subjects['id']]['full_mark'].blank? %>
                                    <% mcq_full_mark = mcq_full_mark+report['result'][report['exam_id']][subjects['id']]['full_mark'].to_i %>
                                  <% end %>
                               <% end %>
                            <% end %>
                          <% end %> 
                          <% if mcq_mark > 0 && mcq_full_mark > 0 %>
                             <% mcq_mark_converted = (mcq_mark.to_f/mcq_full_mark.to_f)*5 %>  
                             <% mcq_mark_converted = sprintf( "%0.02f", mcq_mark_converted) %>
                             <% mcq_mark_converted = mcq_mark_converted.to_f %>
                             <% total_mark = total_mark+mcq_mark_converted %>
                          <% end %>
                          <td class="col-pdf"><%= mcq_mark_converted %></td>
                          <% unless @report_data['report']['exams'].blank? %>
                            <% @report_data['report']['exams'].each do |report| %>
                               <%  if report['exam_category'] == '1' %>
                                  <% if !report['result'].blank? and !report['result'][report['exam_id']].blank? and !report['result'][report['exam_id']][subjects['id']].blank?  and !report['result'][report['exam_id']][subjects['id']]['marks_obtained'].blank? %>
                                    <td class="col-pdf"><%= report['result'][report['exam_id']][subjects['id']]['marks_obtained'] %></td>
                                    <% ct_mark = ct_mark+report['result'][report['exam_id']][subjects['id']]['marks_obtained'].to_f %>
                                  <% end %>
                               <% end %>
                            <% end %>
                          <% end %>
                          <td class="col-pdf"><%= ct_mark %></td>  
                          <% total_mark = total_mark+ct_mark %>
                          <td class="col-pdf"><%= total_mark %></td>
                      </tr>
                    <% end %>
                  <% end %>
                  <%
                    group_exams = GroupedExam.find_all_by_connect_exam_id(@connect_exam_obj.id) 
                    @all_subjects = []
                    group_exams.each do |group_exam|
                      allexams = Exam.find_all_by_exam_group_id(group_exam.exam_group_id);
                      allexams.each do |exam|
                        if !@all_subjects.include?(exam.subject.id)
                          @all_subjects << exam.subject.id
                        end
                      end
                    end 
                 %>
                 <% unless @report_data['report']['no_exam_subject_resutl'].blank? %>
                    <% @report_data['report']['no_exam_subject_resutl'].each do |report| %>
                      <%  if @all_subjects.include?(report['id'].to_i) %>

                        <tr class="<%= cycle(c,(["odd","even"]-[c]).first) %>">

                        <td class="col-pdf border-left-none  no-warp align-left-baf"><%= report['subject_name'] %></td>
                        <% i = 0 %>
                        <% loop do %>
                          <% i = i+1 %>
                          <% if i >= colspan2 %>
                            <% break %>
                          <% end %>
                          <td class="col-pdf">-</td>
                        <% end %>
                        <td class="col-pdf"><b><%= report['subject_comment'] %></b></td>
                        </tr>
                      <% end %>
                    <% end %>
                <% end %>

              </table>
              <% unless @report_data['report']['subjects'].blank? %> 
                <% @report_data['report']['subjects'].each do |subjects| %>
                  <% if subjects['no_exams_sjws'].to_i == 0  or !has_subject_group(subjects['id'].to_i) %>
                     <% next %>
                  <% end %>
                  <table id="pdf-table"  width="30%" class="left-table odd-table height-exam" cellspacing="0" >
                      <tr class="odd"><td colspan='6'><b><%= subjects['name'].upcase %></b></td></tr>
                      <tr class="odd">
                          <td></td>
                          <td>Ex</td>
                          <td>V.G</td>
                          <td>G</td>
                          <td>S</td>
                          <td>NS</td>
                      </tr>
                      <% wordString_main = "" %>
                      <% @report_data['report']['exams'].each do |report| %>
                         <% if report['exam_category'] == '7' %>
                            <% next %>
                         <% end %>
                         <% if !report['result'][report['exam_id']].blank? and !report['result'][report['exam_id']][subjects['id']].blank? and !report['result'][report['exam_id']][subjects['id']]['remarks'].blank?  %>
                          <% if @connect_exam_obj.quarter_number.to_i == report['quarter'].to_i %>
                            <% wordString_main = report['result'][report['exam_id']][subjects['id']]['remarks'] %>
                            <% break %>
                          <% end %>
                         <% end %>
                      <% end %>
                      <% wordString = wordString_main.split("|") %>
                      <% subject_groups = get_subject_group(subjects['id'].to_i) %>
                        <% iloop = 0 %>
                        <% subject_groups.each do |group_name| %>
                             <% if !wordString.blank? and !wordString[iloop].blank? %>
                             <tr class="odd">
                                 <td class="col-pdf align-left"><%= group_name.name %></td>
                                 <td class="col-pdf"><%  if wordString[iloop].to_i == 1 %><%= wicked_pdf_image_tag "/"+("#{Rails.root}/"+ ("public/images/school_logo/tick.png")) %><% end %></td>
                                 <td class="col-pdf"><%  if wordString[iloop].to_i == 2 %><%= wicked_pdf_image_tag "/"+("#{Rails.root}/"+ ("public/images/school_logo/tick.png")) %><% end %></td>
                                 <td class="col-pdf"><%  if wordString[iloop].to_i == 3 %><%= wicked_pdf_image_tag "/"+("#{Rails.root}/"+ ("public/images/school_logo/tick.png")) %><% end %></td>
                                 <td class="col-pdf"><%  if wordString[iloop].to_i == 4 %><%= wicked_pdf_image_tag "/"+("#{Rails.root}/"+ ("public/images/school_logo/tick.png")) %><% end %></td>
                                 <td class="col-pdf"><%  if wordString[iloop].to_i == 5 %><%= wicked_pdf_image_tag "/"+("#{Rails.root}/"+ ("public/images/school_logo/tick.png")) %><% end %></td>
                             </tr>
                             <% else %>
                             <tr class="even">
                                 <td class="col-pdf align-left"><%= group_name.name %></td>
                                 <td class="col-pdf"></td>
                                 <td class="col-pdf"></td>
                                 <td class="col-pdf"></td>
                                 <td class="col-pdf"></td>
                                 <td class="col-pdf"></td>
                             </tr>
                             <% end %>
                       
                          <% iloop = iloop+1 %> 
                        <% end %> 
                  </table>
                <% end %>
              <% end %>
              
              <table id="pdf-table"  width="60%" class="left-table odd-table height-exam" cellspacing="0" >
                  <tr class="even"><td colspan='2'>Quarterly Assessment - March 2019</td></tr>
                  <tr class="even">
                      <td>General Remarks</td>
                      <td><br/><br/><br/><hr/><br/>Signature of the Class Teacher</td>    
                  </tr>
                  <tr class="even"><td colspan='2'><br/><br/><br/><hr/><br/>Signature of the Principal</td></tr>
                  
              </table>  
              <table id="pdf-table"  width="35%" class="left-table odd-table height-exam" cellspacing="0" >
                  <tr class="even"><td colspan='2'>Evaluation Criteria</td></tr>
                  <tr class="even"><td>Ex</td><td>Excellent</td></tr>
                  <tr class="even"><td>V.G</td><td>Very Good</td></tr>
                  <tr class="even"><td>G</td><td>Good</td></tr>
                  <tr class="even"><td>S</td><td>Satisfactory</td></tr>
                  <tr class="even"><td>NS</td><td>Not Satisfactory</td></tr>
              </table>    
          </div>
      </div>



  </div>
<% end %>
<%= stylesheet_link_tag 'list_table' %>
<style>
    .sfx margin-top-bottom-50
    {
        margin: 50px !important;
    }
    .sfx .margin-top-50
    {
        margin-top: 50px !important;
    }

    .sfx
    {
        font-family: serif;
    }
    sfx  .table-header td{
        color: #000;
        font-weight: bold;
    }


    .sfx .left-table
    {
        float:left;
    }
    .sfx .right-table
    {
        float:left;
        margin-left:21px;
    }
    .sfx td.remarks_code_table2
    {
        text-align: left;
        font-size:14px;
    }
    .sfx td.remarks_code_table
    {
        text-align: left;
        font-size:17px;
    }
    .sfx td.remarks_code_table span
    {
        float:left;
    }
    .sfx td.remarks_code_table table
    {
        float:left;
        clear:both;
        text-align: left;
        border:none;

    }
    .sfx td.remarks_code_table table tr
    {
        border:none;
    }
    .sfx td.remarks_code_table table tr td
    {
        border:none;
        padding: 2px 2px 2px 0px;
        text-align: left;
        font-size:17px;
    }
    .no-warp
    {
        white-space: nowrap !important;
    }
    .sfx table.td-align-left td
    {
        text-align: left;
    }
    .sfx table.text-size-18 tr td
    {
        font-size: 17px; 
    }


    .sfx table td.td-align-left
    {
        text-align: left;
    }

    .sfx table td.td-align-right
    {
        text-align: right;
    }
    .sjis table td.border-left-none{
        border-left: 1px solid #000000 !important; 
    } 
    .sjis table td.border-right-none{
        border-right: 1px solid #000000 !important;  
    }
    div.sjis-new
    {
        border: none;
    }


</style>    