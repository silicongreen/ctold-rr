<%-# Champs21
#Copyright 2010 teamCreative Private Limited
#
#This product includes software developed at
#Project Champs21 - http://www.champs21.com/
#
#Licensed under the Apache License, Version 2.0 (the "License");
#you may not use this file except in compliance with the License.
#You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
#Unless required by applicable law or agreed to in writing,
#software distributed under the License is distributed on an
#"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
#KIND, either express or implied.  See the License for the
#specific language governing permissions and limitations
#under the License. -%>
<% unless @report_data.blank? %>
      <div class="section1 row" >
        <center>
          <div class="hor_line"></div>
          <h3>Summative Assessment Report</h3>
        </center>
      </div>
      <div class="CSSTableGenerator" style="width: 97%;margin-top: 20px;">
          <p><%= "#{@student.full_name}" %></p>
          <table id="listing table-design">
              <thead>
                  <tr>
                      <th>Subject Name</b></th>
                      <% unless @report_data['report']['exams'].blank? %>  
                        <% @report_data['report']['exams'].each do |report| %>
                          <th style="padding:0px;">
                            <table>
                                <tr>
                                    <td colspan="2"><%= report['exam_name'] %></td>
                                </tr>
                                <tr>
                                    <td style="width:50%;">Full Marks</td>
                                    <td style="width:50%;">Your Marks</td>
                                </tr>
                                
                             </table>
                          </th> 
                        <% end %>
                      <% end %>

                      <th>Total</th>
                      <th>Marks Obtained (%)</th>
                      <th>Highest Marks (%)</th>
                      <th>Letter Grade</th>
                      <th>GPA</th>
                  </tr>
              </thead>
              <% total_parcent = 0 %>
              <% total_subject = 0 %>
              <% unless @report_data['report']['subjects'].blank? %> 
                <% @report_data['report']['subjects'].each do |subjects| %>
                  <tr>
                      <% weightage_mark = 0 %>
                      <% total_mark = 0 %>
                      <% full_mark = 0 %>
                      
                      <td class="col-2"><b><%= subjects['name'] %></b></td>
                      <% unless @report_data['report']['exams'].blank? %>  
                        <% @report_data['report']['exams'].each do |report| %>
                          <td  style="padding:0px;">
                               
                            <table>
                                
                                <tr>
                                    <td style="width:50%;">
                                      <% if !report['result'].blank? and !report['result'][report['exam_id']].blank? and !report['result'][report['exam_id']][subjects['id']].blank?  and !report['result'][report['exam_id']][subjects['id']]['full_mark'].blank? %>
                                        <%= report['result'][report['exam_id']][subjects['id']]['full_mark'] %>
                                        <% full_mark = full_mark+report['result'][report['exam_id']][subjects['id']]['full_mark'].to_i %>
                                      <% else %>
                                        N/A
                                      <% end %>  
                                    </td>
                                    <td style="width:50%;">
                                      <% if !report['result'].blank? and !report['result'][report['exam_id']].blank? and !report['result'][report['exam_id']][subjects['id']].blank?  and !report['result'][report['exam_id']][subjects['id']]['marks_obtained'].blank? %>
                                        <%= report['result'][report['exam_id']][subjects['id']]['marks_obtained'] %>
                                        <% total_mark = total_mark+report['result'][report['exam_id']][subjects['id']]['marks_obtained'].to_i %>
                                      <% else %>
                                        N/A
                                      <% end %>  
                                    </td>
                                </tr>
                                
                             </table>   
                          
                              
                          </td>
                          
                          <% if !report['result'].blank? and !report['result'][report['exam_id']].blank? and !report['result'][report['exam_id']][subjects['id']].blank?  and !report['result'][report['exam_id']][subjects['id']]['weightage_mark'].blank? %>
                                <% weightage_mark = weightage_mark+report['result'][report['exam_id']][subjects['id']]['weightage_mark'] %>
                          <% end %>

                        <% end %>
                      <% end %>


                       
                      <% main_mark = (total_mark.to_f/full_mark.to_f)*100 %>
                        
                      <% 
                      heighst_mark = 0
                      if !@report_data['report']['max_mark'].blank? and !@report_data['report']['max_mark'][subjects['id']].blank?
                        heighst_mark = (@report_data['report']['max_mark'][subjects['id']].to_f/full_mark.to_f)*100
                      end  
                      
                      %>
                      <% main_mark = (total_mark.to_f/full_mark.to_f)*100 %>
                          
                      <td class="col-2"><b><%= total_mark %></b></td>
                      <td class="col-2"><b><%= sprintf( "%0.02f", main_mark) %> %</b></td>
                      <td class="col-2"><b><%= sprintf( "%0.02f", heighst_mark)   %> %</b></td>
                      <%  grade = GradingLevel.percentage_to_grade(main_mark, @batch.id) %>
                      
                      <% if !grade.blank? and !grade.name.blank? and !grade.credit_points.blank? %>
                      <td class="col-2"><b><%= grade.name %></b></td>
                      <td class="col-2"><b><%= grade.credit_points %></b></td>
                      <% else %>
                      <td class="col-2"><b>-</b></td>
                      <td class="col-2"><b>-</b></td>
                      <% end %>
                      
                      <% total_parcent= total_parcent+main_mark %>
                      <% total_subject = total_subject+1 %>

                  </tr> 
                <% end %>  
              <% end %>     

          </table>
          
          
          <% avgparcent = total_parcent.to_f/total_subject.to_f %>
          <table id="listing table-design" style="margin-top:10px;">
              <tr>
                  <td>Total Number Of Days : <%= @report_data['total'] %> </td>
                  <td>Days Present : <%= @report_data['present'] %></td>
                  <td>Average Marks : <%= sprintf( "%0.02f",avgparcent) %> % </td>
                  <%  grade = GradingLevel.percentage_to_grade(avgparcent, @batch.id) %>
                  
                  <% if !grade.blank?  and !grade.credit_points.blank? %>
                  <td>CGPA : <%= grade.credit_points %> </td>
                  <% else %>
                  <td >-</td>
                  <% end %>    
                  
                
              </tr>  
                  
          </table>
          
          
          <% unless @report_data['report']['no_exam_subject_resutl'].blank? %>
           <div class="section1 row" >
            <center>
              <div class="hor_line"></div>
              <h3>Cumulative Assessment Record</h3>
            </center>
          </div>
            <table id="listing table-design" style="margin-top:20px;">
                <% 
                  iloop = 1
                  cloop = 1
                %>
                <% @report_data['report']['no_exam_subject_resutl'].each do |report| %>
                   
                    <% if iloop == 1 %>
                        <tr>
                    <% end %>
                    <% if cloop == 3 %>
                        </tr>
                        <tr>
                    <% cloop = 1 %>        
                    <%  end %> 
                        <td   width="6%"><%= iloop %></td>
                        <td   width="23%"><%= report['subject_name'] %></td>
                        <% if report['subject_comment'].blank? %>
                          <td   width="23%">Not Tested Yet</td>
                        <% else %>
                          <td   width="23%"><%= report['subject_comment'] %></td>
                        <% end %>
                    <% iloop = iloop+1 %> 
                    <% cloop = cloop+1 %>
                <% end %>
                              
            </table>
          <% end %>
          <%= link_to " â–º #{t('pdf_report')}",
            { :action => "generated_report5_pdf", :batch_id => @batch.id, :student=>@student.id, :type=> @type,:connect_exam=>@connect_exam, :page_height=>450},:target => '_blank', :class=> 'user_button' %>

          <div class="extender"></div>
      </div>

     

<% end %>
<%= stylesheet_link_tag 'list_table' %>

<style type="text/css">
    .CSSTableGenerator table.summary thead tr th
    {
        color: #000;
        padding : 30px;
        background-color:#F2F5F6;
    }
    .CSSTableGenerator table.summary thead tr th:last-child
    {
        border:none;
    }
    .CSSTableGenerator table thead tr th {
        background-color: #f0f2f3;
        border-right: 1px solid #d7dbdd;
        padding: 3px;
        text-align: center;
        font-size: 12px;
    }

    .CSSTableGenerator table#listing  td {
        vertical-align: middle;
        border: 1px solid #D7DBDD;
        text-align: left;
        padding: 15px;
        font-size: 12px;
        font-weight: normal;
        color: #333333;
    }
    .CSSTableGenerator table thead tr th span:last-child
    {
        color: #C00;
        font-size: 35px;
        float:left;
        margin-left: 10px;
        margin-top: 0px;

    }
    .header-wrapper .header-title-sub-text {
        letter-spacing: unset;
    }
    .timetable_last a
    {
        -moz-border-radius: 3px;
        -webkit-border-radius: 3px;
        background: #CB1119 none repeat scroll 0 0;
        color: #FFFFFF !important;
        font-size: 14px;
        font-weight: bold;
        margin-top: 20px;
        padding: 7px 10px;
        border: none;
        text-align: center;
        width: auto;
        cursor: pointer;
        float: left;
        margin-left:8px;
        text-decoration: none;
        display: block;
    }
    .subcontent-date p
    {
        line-height: 1.8;
        margin: 0px;
        padding: 0;
    }
    div.button-link-report
    {

        background: #C91018;
        color:white;

    }
    div.button-link-report:hover
    {
        background: #383838;
    }
    .CSSTableGenerator td
    {
        padding: 10px;
    }
</style> 

