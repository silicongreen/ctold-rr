<%-# Champs21
#Copyright 2010 teamCreative Private Limited
#
#This product includes software developed at
#Project Champs21 - http://www.champs21.com/
#
#Licensed under the Apache License, Version 2.0 (the "License");
#you may not use this file except in compliance with the License.
#You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
#Unless required by applicable law or agreed to in writing,
#software distributed under the License is distributed on an
#"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
#KIND, either express or implied.  See the License for the
#specific language governing permissions and limitations
#under the License. -%>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">



<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/material-design-lite/1.1.0/material.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.13/css/dataTables.material.min.css"/>
<script type="text/javascript" src="//code.jquery.com/jquery-1.12.4.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.10.13/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.10.13/js/dataTables.material.min.js"></script>


<%= stylesheet_link_tag 'tadded-header' %>
<%= stylesheet_link_tag 'form-bootstrap' %>
<% content_for :head do %>
  <%= javascript_include_tag "custom/tabbed-header" %>
<% end %> 


<div class="header-wrapper">

  <div class="header-title">
    <div class="header-icon">
      <%= image_tag '/images/icons/profile-icon.png', :html => {:alt => 'Student Profile'} %>
    </div>
    <div class="header-title-text-wrapper">
      <div class="header-title-main-text f2">
        <%= t('student_details') %>
      </div>
      <div class="clearfix"></div>
      <div class="header-title-sub-text">
        <%= I18n.l(@local_tzone_time.to_date, :format=>'%d/%m/%Y') %>
      </div>
    </div>
  </div>

  <div class="clearfix"></div>

  <div class="tabbed-header-wrapper">
    <ul class="header-tabs">
      <li>
        <%= link_to "Student Search", {:controller => 'student', :action => 'index'}, {:class => 'f2'} %>
      </li>
      <li class="active">
          <%= link_to t('view_all'), {:controller => 'student', :action => 'view_all'}, {:class => 'f2'} %>
      </li>
      <li>
        <%= link_to "Graduation Lists", {:controller => 'student', :action => 'graduation_lists'}, {:class => 'f2'} %>
      </li>
      <li>
          <%= link_to t('advanced'), {:controller => 'student', :action => 'advanced_search'}, {:class => 'f2'} %>
      </li>
  
    </ul>
  </div>

</div>
<div id="page-yield">
  <% form_for(@student, :url => {:action=> 'view_all'}, :html=> {:id=>'new_student'}) do |s| %>  
  <% unless flash[:notice].nil? %>
    <p class="flash-msg"> <%= flash[:notice] %> </p>
  <% end %>
    
  <% if Batch.active.find(:all, :group => "name").length > 1  %> 
  <div class="form-group col-sm-6">
    <label for="student_grade"><%= t('shift_label') %></label>
      <select id="batch_name" name="batch_name" onchange="filterbatch(this)">
          <option value="" selected="selected">Select a Shift</option>
          <% Batch.active.find(:all, :group => "name").each do |batch| %>
                <% batchsplit = batch.name.split(" ") %>
                <option value="<%= batchsplit[0] %>"><%= batchsplit[0] %></option>
          <% end %>
      </select>
  </div>
  <div class="form-group col-sm-6">
    <label for="student_grade"><%= "Version" %></label>
      <select id="version_name" name="version_name" onchange="filterversion(this)">
            <% version_array = [] %>
            <option value="" selected="selected">Select a Version</option>
            <% Batch.active.find(:all, :group => "name").each do |batch| %>
                  
                  <% 
                    batchsplit = batch.name.split(" ")
                    version = ""
                    unless batchsplit[1].blank?
                      version = batchsplit[1]
                    end
                    unless batchsplit[2].blank?
                      version = version+" "+batchsplit[2]
                    end
                
                  %>
                  <% if !version_array.include?(version) && !version.blank? %>
                  <% version_array << version %>
                  <option value="<%= version %>"><%= version %></option>
                  <% end %>
            <% end %>
      </select>
  </div>
  <% end %>
    
  <div class="form-group col-sm-6">
    <label for="student_grade"><%= "Class" %></label>
    <select id="class_name" name="class_name" onchange="filterclass(this)">
        <option value="" selected="selected">Select a Class</option>
        <% Course.active.find(:all, :group => "course_name").each do |course| %>
            <option value="<%= course.course_name %>"><%= course.course_name %></option>
        <% end %>
    </select>
  </div>
    
  <div class="form-group col-sm-6">
      <label for="student_grade"><%= "Session" %></label>
      <select id="session_name" name="session_name" onchange="filtersession(this)">
          <option value="" selected="selected">Select a Session</option>
          <% Course.active.find(:all, :group => "session").each do |course| %>
              <% unless course.session.blank?  %>
                <option value="<%= course.session %>"><%= course.session %></option>
              <% end %>
          <% end %>
      </select>
  </div>
    
  <div class="form-group col-sm-6">
      <label for="student_grade"><%= "Group" %></label>
      <select id="group_name" name="group_name" onchange="filtergroup(this)">
          <option value="" selected="selected">Select a Group</option>
          <% Course.active.find(:all, :group => "`group`").each do |course| %>
              <% unless course.group.blank?  %>
                <option value="<%= course.group %>"><%= course.group %></option>
              <% end %>
          <% end %>
      </select>
  </div>

  <% end %>
  <div id="students" style="float:left;"> 
      <table class="mdl-data-table" id="hr_report" cellspacing="0" width="100%" style="float:left; clear:both; margin:10px 0px;">
          <thead>
            <th width="20%" data-orderable="false"><%= "Name" %></th>
            <th width="15%" data-orderable="false"><%= "Admission No" %></th>
            <th width="13%" data-orderable="false"><%= "Shift" %></th>
            <th width="13%" data-orderable="false"><%= "Version" %></th>
            <th width="13%" data-orderable="false"><%= "Class" %></th>
            <th width="13%" data-orderable="false"><%= "Section" %></th>
            <th width="13%" data-orderable="false"><%= "Session" %></th>
            <th width="13%" data-orderable="false"><%= "Group" %></th>
          </thead>
      </table>
  </div>

</div>
<script>
  var oDataTable;
  var jq = jQuery.noConflict();
  jq(document).ready(function() {
  oDataTable = jq('#hr_report').DataTable( {
        processing: true,
        serverSide: true,
        "searching": false,
        "bLengthChange": false,
        "info": false,
        ajax: {
            url: "/student/get_student_ajax",
            type: 'POST'
        },
        columns: [
            { "data": "student_name" },
            { "data": "admission_no" },
            { "data": "batch" },
            { "data": "version" },
            { "data": "class" },
            { "data": "section" },
            { "data": "session" },
            { "data": "group" }
        ]
    });
    
  });
  function filterbatch(data)		
    {		
        var value = jq("#batch_name").val();
        if(jq("#version_name").val())
        {
          value = value+" "+jq("#version_name").val()
        }  
        oDataTable.column( 3 ).search( value ).draw(); 		

    }
  function filterversion(data)		
    {		
        var value = jq("#version_name").val();	
        if(jq("#batch_name").val())
        {
          value = jq("#batch_name").val()+" "+value
        }
        oDataTable.column( 3 ).search( value ).draw(); 		

    }
  function filterclass(data)		
  {		
      var value = jq("#class_name").val();
      oDataTable.column( 4 ).search( value ).draw(); 		

  }
  function filtersession(data)		
  {		
      var value = jq("#session_name").val();
      oDataTable.column( 6 ).search( value ).draw(); 		

  }
  function filtergroup(data)		
  {		
      var value = jq("#group_name").val();
      oDataTable.column( 7 ).search( value ).draw(); 		

  }
  function filtersection(data)		
  {		
      var value = jq("#section_name").val();
      oDataTable.column( 5 ).search( value ).draw(); 		

  }
</script>  
