<div class="box_content">
  <div class="partial_classwork" style="padding: 0px 0px;">
  <!--<h2 class="f2 routine">classwork</h2>-->
  
  
<div class="header-wrapper">
  <div class="header-title">
    <div class="header-icon">
      <%= image_tag '/images/icons/classwork_web.png', :html => {:alt => 'classwork'} %>
    </div>
    <div class="header-title-text-wrapper">
      <div class="header-title-main-text f2">
       <%= link_to "Classwork", :controller => 'classworks', :action => 'index' %> 
       <span style="float: left;clear:both;font-size: 15px;"><%= Time.now.strftime("%d %b %Y") %></span>
      </div>      
    </div>    
  </div>
  
    <% if @current_user.employee?  %> 
    <div class="header-form-wrapper">
      <div class="label-field-pair">
        <label for="classwork_subject"><%= "#{t('subject_and_class')}"%></label>
        <div class="text-input-bg">
          <% unless @subjects.nil? %>
            <%= select :classwork, :subject,
              @subjects.map {|s| ["#{s.name}  - #{s.batch.full_name}",s.id]},
              {:prompt => "#{t('select_subject_and_class')}"},
              {:onChange => "#{remote_function(:url => {:action => "subject_classworks"},
              :with => "'subject_id='+ value +'&is_published='+ $('classwork_is_published').value",
              :before => "Element.show('loader')",
              :success => "Element.hide('loader')"
              )}"} %>
        </div>
          <%= image_tag("loader.gif",:align => "absmiddle",:border => 0,:id => "loader", :style =>"display: none;" ) %>
      </div>
            
      
      <div class="label-field-pair" style="float:left; clear:both;">
        <label for="classwork_is_published">Status</label>
        <div class="text-input-bg">
          
            <%= select :classwork, :is_published,
              [['Active', 1], ['Draft', 0]],
              {:prompt => "Select classwork Status"},
              {:onChange => "#{remote_function(:url => {:action => "subject_classworks"},
              :with => "'is_published='+ value +'&subject_id='+ $('classwork_subject').value",
              :before => "Element.show('loader')",
              :success => "Element.hide('loader')"
              )}"} %>
        </div>
          <%= image_tag("loader.gif",:align => "absmiddle",:border => 0,:id => "loader", :style =>"display: none;" ) %>
      </div>  
    <% else %>
      <p class="flash-msg"> <%= "#{t('there_are_no_subjects_assigned_to_this_employee')}"%> </p>
    <% end %>
     </div>
    <% elsif @current_user.student? or @current_user.parent? %>
    <div class="header-form-wrapper">
      <div class="label-field-pair">
        <label for="classwork_subject"><%= "#{t('subject')}"%></label>
        <div class="text-input-bg">
          <% unless @subjects.nil? %>
            <%= select :classwork, :subject,
              @subjects.map {|s| ["#{s.name}",s.id]},
              {:prompt => "#{t('select_a_subject')}"},
              {:onChange => "#{remote_function(:url => {:action => "subject_classworks2"},
              :with => "'subject_id='+ value",
              :before => "Element.show('loader')",
              :success => "Element.hide('loader')"
              )}"} %>
        </div>
      </div>
      
      <div style=" float: left; clear:both; margin: 15px 0px; width: 95%;">
        <%= image_tag("loader.gif",:align => "absmiddle",:border => 0,:id => "loader", :style =>"display: none;" ) %>
      </div>
      <% else %>
        <p class="flash-msg"> <%= "#{t('there_are_no_subjects_assigned_to_this_employee')}"%> </p>
      <% end %>
    </div>
    <% end %>
 
  <div class="clearfix"></div>
  <% if @current_user.admin? %>
  
  <% else %>
    <% if  permitted_to? :new,:classworks %>
      <div class="tabbed-header-wrapper">    
        <ul class="header-tabs">
          <li>          
            <%= link_to t('create_new_classwork'), {:controller => "classworks", :action => "new"}, :class => 'f2' %>
          </li>      
        </ul>
      </div>
    <% end %>
  <% end %>
</div>  
  <% if @current_user.employee?  %>
    <div id="page-yield" class="bg-disable">
    <% elsif @current_user.student? %>
      <div id="page-yield" class="bg-disable">
      <% elsif @current_user.parent? %>
        <div id="page-yield" class="bg-disable">
        <% elsif @current_user.admin? %>
          <div id="page-yield" style="margin-top: 0px;">
          <% end %>

          <% unless flash[:notice].nil? %>
            <p class="flash-msg"> <%= flash[:notice] %> </p>
          <% end %>

          <% if @current_user.employee?  %>
              <div id="subject_classworks_list" style="clear: both"></div>
          <% elsif @current_user.student? or @current_user.parent? %>
              <div id="listing">
              <% unless @classworks.nil? %>
                    <% total_classwork = @classworks.count %>
                    <% i = 1 %>
                    <% @classworks.each_with_index do |classwork,j| %>
                      <% unless classwork.subject.nil? %>
                        <div class="portlet-subcontent" style="width:100%">     
                          <div class="timetable_left">
                            <% if classwork.subject.icon_number? %>
                                  <%= image_tag("icons/subjects/"+classwork.subject.icon_number , :size=> "83x60", :alt=> classwork.subject.name) %>
                                <% else %>
                                  <%= image_tag("icons/subjects/8.png" , :size=> "83x60", :alt=> classwork.subject.name) %>
                            <% end %>

                          </div>
                          <%
                                    unless classwork.subject.employees.nil?
                                      emp_name = classwork.subject.employees[0].first_name
                                      unless classwork.subject.employees[0].middle_name.nil?
                                        emp_name += ' ' + classwork.subject.employees[0].middle_name
                                      end
                                      unless classwork.subject.employees[0].last_name.nil?
                                        emp_name += ' ' + classwork.subject.employees[0].last_name
                                      end
                                    end
                                  %>
                          <div class="timetable_right"  style="float:left;height: 70px;width: 40%;padding: 10px 0;">
                            <div class="subcontent-header themed_text">
                                <%=  link_to classwork.subject.name.to_s+' - '+classwork.title, classwork%>

                            </div>                           
                            <div class="subcontent-info"><%= emp_name %> </div>              
                          </div>
                          <div class="timetable_right"  style="float:left;height: 70px;width: 35%;padding: 10px 0;border-left:1px dotted #cccccc">                            
                            <div class="subcontent-date"><b style="color:#000;">Assign Date &nbsp;:&nbsp; </b><%= I18n.l(classwork.created_at,:format=>"%A, %d %B, %Y") %></div>  
                                                            
                          </div> 
                            
                          
                       </div>
                        
                        <% if i<total_classwork %>
                           <div style="float: left; margin: 7px; width: 95%;"></div> 
                        <% else %>
                          <div style=" margin: 7px;float: left; width: 95%;"></div> 
                        <% end %>
                        <% i = i+1 %>
                      <% end %>
                    <% end %>
                 <% else %>
                 <div class="portlet-subcontent">    
                   No classwork Submitted
                 </div>  
            <% end  %>
            <div class="pagination_div"><div class="div1"><%= will_paginate @classworks, :previous_label=>"<", :next_label=>">", :renderer => 'RemoteLinkRenderer' ,:remote => { :loading =>  "$('loader_paginate').show();",:complete =>"$('loader').hide();"  }, :params => {:controller=>:classworks,:action => "subject_classworks2"} %></div><div class="div2"><%= image_tag("loader.gif",
          :align => "absmiddle",
          :border => 0,
          :id => "loader_paginate",
          :style =>"display: none;" ) %></div></div>
           </div>
          
              
          <% elsif @current_user.admin? %>
            <% form_for(@student, :url => {:action=> 'view_all'}, :html=> {:id=>'new_student'}) do |s| %>    
              <%# if Batch.active.find(:all, :group => "name").length > 1  %> 
                <div class="label-field-pair" style="margin: 0px auto;">
                  <label for="student_grade"><%= t('shift_label') %></label>
                  <div class="text-input-bg">
                    <%= select :student, :batch_name, options_for_select(Batch.active.find(:all, :group => "name").map {|b| [b.name, b.id]}, @batch_no.to_i), 
                      {:prompt => "#{t('select')}"},
                      {:onChange => "#{remote_function(:url => {:controller => "student", :action => "get_classes"}, :with => "'batch_id='+value+'&'+$('new_student').serialize()+'&page=course_classwork&partial_view=student/courses_classwork&section_page=section_classwork&section_partial=student/sections_classwork_view'" ,:before => "$('loading_2').show();",
                      :success => "$('loading_2').hide();")}"} %>
                    <%= image_tag("loader.gif", :align => "absmiddle", :border => 0, :id => "loading_2", :style =>"display: none;" ) %></div>
                </div>
              <%# end %>
              <div class="label-field-pair" style="margin: 0px auto;">
                <label for="student_grade"><%= t('class_label') %></label>
                <div class="text-input-bg"><div id="course_classwork"> <%= render :partial => 'student/courses_classwork', :object => @courses %></div></div>
              </div>        
              <div class="label-field-pair" id="sections_div" style="margin: 0px auto;">
                <label for="student_grade"><%= t('section_label') %></label>
                <div class="text-input-bg"><div id="section_classwork"> <%= render :partial => 'student/sections_classwork_view', :object => @classes %></div></div>
              </div>             
            <% end %><%# FORM END%>  

         
            <div id="syllabus" class="news_label_field"></div>
            <br />
            <div id="listing"></div>
            <script type="text/javascript">
                var jj = jQuery.noConflict();
                jj("#student_batch_name").on("change", function (event) {
                    jj("#listing").html("");
                    jj("#syllabus").html("");
                    jj.get("classworks/get_classwork_filter", {batch_name: jj("#student_batch_name").val()})
                            .done(function (data) {

                            });
                });

                jj(document).off("change", "#student_class_name").on("change", "#student_class_name", function (event) {
                    jj("#listing").html("");
                    jj("#syllabus").html("");
                    jj.get("classworks/get_classwork_filter", {batch_name: jj("#student_batch_name").val(), student_class_name: jj("#student_class_name").val()})
                            .done(function (data) {
                            });
                });

                jj(document).off("change", "#student_section").on("change", "#student_section", function (event) {
                    jj("#listing").html("");
                    jj.get("classworks/get_classwork_filter", {batch_name: jj("#student_batch_name").val(), student_class_name: jj("#student_class_name").val(), student_section: jj("#student_section").val()})
                            .done(function (data) {
                            });
                });


                jj(document).off("change", "#classwork_subject").on("change", "#classwork_subject", function (event) {
                    if (jj("#classwork_subject").val() == "")
                    {
                        jj("#listing").html("");
                        jj.get("classworks/get_classwork_filter", {batch_name: jj("#student_batch_name").val(), student_class_name: jj("#student_class_name").val(), student_section: jj("#student_section").val()})
                                .done(function (data) {
                                });
                    }
                });
              </script> 
          <% end %>

        </div>
  </div>        
</div>
<%= stylesheet_link_tag 'list_table' %>
<style type="text/css">
          .calendar_date_select_popup_icon{
            margin: 9px 1px 0;
          }
          .attachment {
            background: url("/images/classwork/paperclip.png") no-repeat left;
            padding-left: 11px;
            height: 35px;
          }
          .clear-date {
            color: #db3434;
            cursor: pointer;
            float: right;
            font-size: 12px;
            margin-right: 45px;
            margin-top: 9px;
            width: 0;
          }
          div h2.routine
          {

            width: 60%;
          }
          .pagination
          {
            margin-bottom:30px;
          }
          .select2-container
          {
            margin-left:10px;
            width: 200px !important;
          }
          .select2-container--open .select2-dropdown--above
          {
             margin-left: -10px;
          }
          .select2-container--open .select2-dropdown--below
          {
              margin-left: -10px;
          }
          .CSSTableGenerator table thead tr th{
        text-align: center;
        padding: 10px;
        }
        .CSSTableGenerator td a
        {
          color: inherit;
          padding : 0;
          background-color: inherit;
          float: none;  
          display: block;

        }
        .CSSTableGenerator td a:hover
        {
          color: inherit;
          padding : 0;
          background-color: inherit;
          float: none;
          display: block;

        }
        .CSSTableGenerator table tr td 
        {
          text-align: center;
          font-weight: bold;
          overflow: hidden;
          padding: 5px !important;
        }
  </style>

<% content_for :head do %>
  <%= javascript_include_tag "custom/classwork" %>
<% end %>
<%= stylesheet_link_tag 'pagination_and_table' %>

<%= stylesheet_link_tag 'tadded-header' %>        
<script>
  var jq = jQuery.noConflict();
  jq(document).ready(function() {
    jq('#classwork_subject').select2();
  });
  
</script>
