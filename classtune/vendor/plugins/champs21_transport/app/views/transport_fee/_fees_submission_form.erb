<% unless @transport_fee.nil? %>
  <% unless flash[:notice].nil? %><p class="flash-msg"><%= flash[:notice] %></p><% end %>
  <% unless flash[:warn_notice].nil? %>
    <div id="errorExplanation" class="errorExplanation"><%= flash[:warn_notice] %> </div>
  <% end %>
  <div class="extender"></div>
  <%if @transport_fee.transaction_id.nil? and @fine.nil?%>
    <% unless @student.blank? %>
      <%= render :partial => "student_fine_submission" %>
    <% else %>
      <%= render :partial => "employee_fine_submission" %>
    <% end %>
  <%end%>

  <% total_fees =0 %>
  <% remote_form_for :fees, :url => {:action => 'transport_fee_collection_pay', :student => @transport_fee.receiver_id}, :before=>"$('submit_button').disable()",:complete=>"setTimeout(function(){$('submit_button').enable();},5000)" do |form| %>

    <% unless @transport_fee.bus_fare.nil?%>
      <table class="table table-striped table-bordered" id="example" cellspacing="0" cellpadding="0" border="0" style="width: 98%;">
        <thead><!-- class="thead-inverse" -->
          <tr>
            <th><%= t('name') %></th>
            <th style="text-align: right;"><%= t('amount') %> (<%= currency %>  )</th>
          </tr>
        </thead>
        <tbody>
          <tr class="<%= cycle("odd","even") %>">
              <td class="col-2" style="padding-left: 30px;"><%= @transport_fee.receiver.full_name %></td>
              <td class="col-6" style="text-align: right; padding-right: 10px;"><%= precision_label(@transport_fee.bus_fare) %></td>
          </tr>
          <% total_fees += @transport_fee.bus_fare.to_f %>

          <%if @transport_fee.transaction_id.nil? %>
            <% unless @fine.nil? %>
              <tr class="tr-blank"></tr>
              <tr class="<%= cycle("odd","even") %>">
                <td class="col-2" style="padding-left: 30px;"><%= t('fine') %></td>
                <td class="col-6" style="text-align: right; padding-right: 10px;"><%= precision_label(@fine) %></td>
              </tr>
              <% total_fees += @fine.to_f %>
            <% end %>
          <%else%>
            <% unless @transaction.blank? %>
              <% if @transaction.fine_included == true %>
                <tr class="tr-blank"></tr>
                <tr class="<%= cycle("odd","even") %>">
                  <td class="col-2" style="padding-left: 30px;">><%= t('fine_paid') %></td>
                  <% fine = @transaction.fine_amount %>
                  <td class="col-6" style="text-align: right; padding-right: 10px;"><%#= fine %><%= precision_label(fine) %></td>
                </tr>
              <%end%>
            <% end %>
          <%end%>
          
          <tr class="tr-blank"></tr>
          <tr class="tr-blank"></tr>
          <tr class="tr-<%= cycle("odd","even") %>" cellpadding="1" cellspacing="1">
              <td class="col-2" style="padding-left: 30px;"><%= t('total_fees') %></td>
              <td class="col-6" style="text-align: right; padding-right: 10px;"><%= precision_label(total_fees)%></td>
          </tr>
                
          <%if @transport_fee.transaction_id.nil? %>
            <tr>
              <td colspan="2">
                <div class="payment_details" style="width: 100%;">
                    <div style="width: 59%; float: left; border-right: 1px solid #ccc;">
                        <div class="label-field-pair" style="width: 99% !important;">
                          <div class="label-container"><%= t('payment_mode') %>  <%= image_tag("loader.gif",
                            :align => "absmiddle",
                            :border => 0,
                            :id => "loader1",
                            :style =>"display: none;" ) %></div>
                          <div class="input-container">
                              <%= select :fees, :payment_mode, [["#{t('cash')}", "#{t('cash')}"],["#{t('online_payment')}", "#{t('online_payment')}"],["#{t('cheque')}", "#{t('cheque')}"],["#{t('dd')}","#{t('dd')}"],["#{t('others')}", "#{t('others')}"]], {} ,{:onChange => "#{remote_function(:url => {:action => "select_payment_mode"},
                                  :with => "'payment_mode='+value",:before => "$('loader1').show();",
                                  :success => "$('loader1').hide();")}"}  %>
                          </div>
                      </div>
                      <div class="label-field-pair" style="width: 99% !important;">
                        <div class="label-container"><%= t('payment_notes') %> </div>
                        <div class="input-container"><%= form.text_area :payment_note,:cols => 50, :rows => 1 %></div>
                      </div>
                  </div>
                  <div class="pay_fees" style="width: 11%; float: left; padding-left: 29%; padding-top: 8%;">
                    <%= form.hidden_field :transport_fee_id , :value =>@transport_fee.id %>
                    <% unless @fine.nil? %>
                      <%= form.hidden_field :fine , :value =>@fine %>
                    <% end %>
                    <%= form.submit "► #{t('pay_fees')}" ,:class=>"user_button",:id => 'submit_button',:onClick => "return validate_payment_mode()"%>
                  </div>
                </div>
              </td>
            </tr>
            <tr>
              <td colspan="5">
                <div id="payment_mode"></div>
              </td>
            </tr>
          <% else %>
            <tr>
              <td colspan="2">
                <div>
                    <h4 style="border: 1px solid #ccc; padding: 10px; border-radius: 4px; background: #fff;"><%= "#{t('fees_paid')}"%>  </h4>
                  <div class="pay_fees">
                    <%= link_to " ► #{t('print_receipt')}",
                      { :action => "transport_fee_receipt_pdf", :id =>@transaction.id },:target => '_blank', :class=> 'user_button' %>
                  </div>
                </div>
              </td>
            </tr>
          <%end%>
          </tbody>
      </table>
    <% else %>
      <p class="flash-msg"> No fees </p>
    <%end%>

  <% end %>

  <%unless @transport_fee.transaction_id.nil? %>
    <div class="label-field-pair3">
      <label><%= t('payment_history') %> </label>
    </div>
    <div id="payments_details" style="margin-top:40px;">

      <table class="table table-striped table-bordered" id="example" cellspacing="0" cellpadding="0" border="0" style="width: 98%;">
        <thead><!-- class="thead-inverse" -->
          <tr>
            <th><%= t('sl_no') %></th>
            <th><%= t('payment_date') %></th>
            <th><%= t('payment_mode') %></th>
            <th><%= t('payment_notes') %></th>
            <th><%= t('amount') %> (<%= currency %>  )</th>
            <th style="width:2%;"></th>
          </tr>
        </thead>
        <tbody>
          <tr class="<%= cycle("odd","even") %>">
            <td class="col-1"><%= i =1 %></td>
            <td class="col-3"><%= @transport_fee.finance_transaction.transaction_date %></td>
            <td class="col-3"><%= @transport_fee.finance_transaction.payment_mode %></td>
            <td class="col-2"><%= @transport_fee.finance_transaction.payment_note %></td>
            <td class="col-3" >
              <%#= @transport_fee.finance_transaction.amount.to_f %>
              <%= precision_label(@transport_fee.finance_transaction.amount.to_f) %>
            </td>
            <td class="col-3" style="width:2%;"> <div class="cancel" ><%=link_to_remote ("&times"),{:url=>{:controller=>:transport_fee,:action=>:delete_transport_transaction,:transaction_id=>@transport_fee.id,:id=>@transport_fee.receiver_id,:date=>@transport_fee.transport_fee_collection_id},:confirm=>"#{t('are_you_sure_want_delete_this_transaction')}"},{:class=>"themed_text"}%></div></td>
          </tr>
        </tbody>
      </table>

    </div>
  <%end%>
<% end %>

<style>
    a {
      font-size: 11px;
      text-decoration: underline;
      font-family: verdana;
    }
    td {
      font-size: 12px;
      font-family: verdana;
    }
</style>